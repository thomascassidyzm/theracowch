<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Cowch - AI Wellness Coaching</title>
  <script src="https://unpkg.com/vue@3/dist/vue.global.prod.js"></script>
  <script>
    // Tailwind CSS configuration for production
    if (typeof tailwind !== 'undefined') {
      tailwind.config = {
        theme: {
          extend: {
            backdropBlur: {
              xs: '2px',
            }
          }
        }
      }
    }
  </script>
  <script src="https://cdn.tailwindcss.com?plugins=forms,typography,aspect-ratio"></script>
  
  <!-- PWA Configuration -->
  <link rel="manifest" href="manifest.json">
  <meta name="mobile-web-app-capable" content="yes">
  <meta name="apple-mobile-web-app-capable" content="yes">
  <meta name="apple-mobile-web-app-status-bar-style" content="black-translucent">
  <meta name="apple-mobile-web-app-title" content="Cowch">
  <meta name="theme-color" content="#FAF6F3">
  <meta name="msapplication-TileColor" content="#FAF6F3">

  <!-- Icons -->
  <link rel="icon" href="icons/icon-96x96.svg" type="image/svg+xml">
  <link rel="apple-touch-icon" href="apple-touch-icon.png">
  <link rel="mask-icon" href="icons/icon-192x192.svg" color="#EE701A">
  
  <style>
    /* Mandy's Classic Refined Design System */

    :root {
      /* Mandy's Color Palette - Classic & Therapeutic */
      --color-bg-primary: #FAF6F3;          /* Soft beige from Mandy's site */
      --color-bg-secondary: #FFFFFF;        /* Clean white */
      --color-bg-accent: #FFF8F3;           /* Very light peachy tint */

      --color-text-primary: #54595F;        /* Professional gray */
      --color-text-secondary: #7A7A7A;      /* Lighter gray */
      --color-text-dark: #3D3D3D;           /* Dark for headings */

      --color-accent-primary: #EE701A;      /* Mandy's warm orange */
      --color-accent-secondary: #D8956D;    /* Muted salmon */
      --color-accent-tertiary: #C89F18;     /* Golden accent */
      --color-accent-soft-blue: #6EC1E4;    /* Soft blue accent */

      /* Consistent spacing scale */
      --spacing-xs: 0.5rem;    /* 8px */
      --spacing-sm: 0.75rem;   /* 12px */
      --spacing-md: 1rem;      /* 16px */
      --spacing-lg: 1.5rem;    /* 24px */
      --spacing-xl: 2rem;      /* 32px */
      --spacing-2xl: 3rem;     /* 48px */
      --spacing-3xl: 4rem;     /* 64px */

      /* Section spacing */
      --section-gap: var(--spacing-2xl);
      --card-padding: var(--spacing-lg);
      --content-max-width: 64rem;
    }

    body {
      min-height: 100vh;
      background: var(--color-bg-primary);
      color: var(--color-text-primary);
      font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', system-ui, sans-serif;
      font-size: 17px;
      font-weight: 400;
      line-height: 1.6;
      -webkit-font-smoothing: antialiased;
      -moz-osx-font-smoothing: grayscale;
    }

    h1, h2, h3, h4, h5, h6 {
      font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', system-ui, sans-serif;
      font-weight: 600;
      color: var(--color-text-dark);
      letter-spacing: -0.02em;
    }

    .glass {
      border: 1px solid rgba(84, 89, 95, 0.08);
      background: var(--color-bg-secondary);
      box-shadow: 0 2px 12px rgba(84, 89, 95, 0.06);
    }

    .glass-dark {
      border: 1px solid rgba(84, 89, 95, 0.12);
      background: var(--color-bg-accent);
      box-shadow: 0 2px 16px rgba(84, 89, 95, 0.08);
    }

    .card {
      @apply glass rounded-xl transition-all duration-200;
      background: var(--color-bg-secondary);
      padding: var(--card-padding);
    }

    .card:hover {
      box-shadow: 0 4px 20px rgba(84, 89, 95, 0.1);
      border-color: rgba(238, 112, 26, 0.15);
    }

    .btn-primary {
      @apply inline-flex items-center justify-center px-8 py-3.5 font-medium text-white transition-all duration-200 ease-out;
      border-radius: 0.5rem;
      background: var(--color-accent-primary);
      box-shadow: 0 2px 8px rgba(238, 112, 26, 0.25);
      border: none;
      min-height: 3rem;
      line-height: 1.4;
      display: flex;
      align-items: center;
      justify-content: center;
      font-size: 1rem;
    }

    .btn-primary:hover {
      background: #D96418;
      box-shadow: 0 4px 16px rgba(238, 112, 26, 0.35);
      transform: translateY(-1px);
    }

    .btn-primary:active {
      transform: translateY(0);
      transition: all 0.1s ease-out;
    }

    .btn-glass {
      @apply inline-flex items-center justify-center px-8 py-3.5 font-medium transition-all duration-200 ease-out;
      border-radius: 0.5rem;
      border: 1px solid var(--color-accent-secondary);
      background: transparent;
      color: var(--color-accent-primary);
      box-shadow: 0 2px 8px rgba(84, 89, 95, 0.08);
      min-height: 3rem;
      line-height: 1.4;
      display: flex;
      align-items: center;
      justify-content: center;
      font-size: 1rem;
    }

    .btn-glass:hover {
      transform: translateY(-1px);
      background: var(--color-bg-accent);
      border-color: var(--color-accent-primary);
      box-shadow: 0 4px 12px rgba(238, 112, 26, 0.15);
    }

    .btn-glass:active {
      transform: translateY(0);
      transition: all 0.1s ease-out;
    }

    .btn-small {
      @apply inline-flex items-center justify-center font-medium transition-all duration-200 ease-out;
      border-radius: 0.375rem;
      border: 1px solid rgba(84, 89, 95, 0.15);
      background: var(--color-bg-secondary);
      color: var(--color-text-primary);
      box-shadow: 0 1px 4px rgba(84, 89, 95, 0.08);
      min-height: 2rem;
      padding: 0.5rem 0.875rem;
      font-size: 0.875rem;
      line-height: 1.4;
      text-align: center;
    }

    .btn-small:hover {
      transform: translateY(-1px);
      background: var(--color-bg-accent);
      border-color: var(--color-accent-secondary);
      box-shadow: 0 2px 8px rgba(84, 89, 95, 0.12);
      color: var(--color-accent-primary);
    }

    .btn-small:active {
      transform: translateY(0);
      transition: all 0.1s ease-out;
    }

    .imagine-card {
      @apply cursor-pointer transform transition-all duration-200 relative overflow-hidden;
      border: 1px solid rgba(84, 89, 95, 0.12);
      background: var(--color-bg-secondary);
      border-radius: 1rem;
      padding: var(--card-padding);
      box-shadow: 0 2px 12px rgba(84, 89, 95, 0.08);
    }

    .imagine-card:hover {
      transform: translateY(-4px);
      border-color: var(--color-accent-secondary);
      background: var(--color-bg-accent);
      box-shadow: 0 8px 24px rgba(238, 112, 26, 0.15);
    }

    .gradient-text {
      color: var(--color-accent-primary);
      font-weight: 600;
    }

    /* Light theme text colors */
    .text-white {
      color: var(--color-text-dark) !important;
    }

    .text-stone-300 {
      color: var(--color-text-secondary) !important;
    }

    .text-amber-200 {
      color: var(--color-accent-primary) !important;
    }

    .text-stone-400 {
      color: var(--color-text-secondary) !important;
    }

    .text-stone-500 {
      color: var(--color-text-secondary) !important;
    }

    .text-stone-600 {
      color: var(--color-text-primary) !important;
    }

    .pulse-glow {
      animation: pulseGlow 2s ease-in-out infinite;
    }

    @keyframes pulseGlow {
      0%, 100% {
        box-shadow: 0 0 8px rgba(238, 112, 26, 0.3);
      }
      50% {
        box-shadow: 0 0 16px rgba(238, 112, 26, 0.5);
      }
    }

    .emoji-bounce {
      animation: emojiFloat 3s ease-in-out infinite;
    }

    @keyframes emojiFloat {
      0%, 100% { transform: translateY(5px) rotate(0deg); }
      50% { transform: translateY(-5px) rotate(5deg); }
    }

    .hex-badge {
      @apply inline-flex items-center justify-center px-3 py-1 rounded-full text-xs font-medium;
      border: 1px solid rgba(99, 102, 241, 0.3);
      color: #a8b4fc;
      backdrop-filter: blur(4px);
      background: linear-gradient(135deg, rgba(133, 144, 248, 0.2), rgba(232, 169, 104, 0.1));
    }

    @keyframes fadeInUp {
      from {
        opacity: 0;
        transform: translateY(20px);
      }
      to {
        opacity: 1;
        transform: translateY(0);
      }
    }

    .animate-fade-in-up {
      animation: fadeInUp 0.6s ease-out forwards;
    }
    
    .animate-float {
      animation: float 3s ease-in-out infinite;
    }
    
    @keyframes float {
      0%, 100% { transform: translateY(0px); }
      50% { transform: translateY(-10px); }
    }

    .input-field {
      @apply w-full px-4 py-3 rounded-lg border transition-all duration-200;
      border: 1px solid rgba(84, 89, 95, 0.2);
      background: var(--color-bg-secondary);
      color: var(--color-text-primary);
      font-family: 'Roboto', sans-serif;
      font-size: 1rem;
    }

    .input-field::placeholder {
      color: var(--color-text-secondary);
      opacity: 0.7;
    }

    .input-field:focus {
      outline: none;
      border-color: var(--color-accent-primary);
      background: var(--color-bg-secondary);
      box-shadow: 0 0 0 3px rgba(238, 112, 26, 0.1);
    }

    /* Badge styles */
    .badge {
      display: inline-flex;
      align-items: center;
      padding: 0.5rem 1rem;
      border-radius: 2rem;
      font-size: 0.875rem;
      font-weight: 500;
      border: 1px solid var(--color-accent-secondary);
      background: var(--color-bg-accent);
      color: var(--color-accent-primary);
    }
  </style>
</head>

<body>
  <div id="app">
    <!-- Main App Container -->
    <div class="min-h-screen">
      
      <!-- Navigation Header -->
      <nav class="fixed top-0 left-0 right-0 z-50 glass-dark border-b" style="border-color: rgba(84, 89, 95, 0.1);">
        <div class="max-w-4xl mx-auto px-6 py-4">
          <div class="flex items-center justify-between">
            <div class="flex items-center" style="gap: var(--spacing-sm);">
              <div class="w-10 h-10 rounded-xl overflow-hidden shadow-md" style="border: 2px solid var(--color-accent-secondary);">
                <img src="assets/theracowch_main_image.jpg" alt="AI Mandy Cow" class="w-full h-full object-cover"
                     style="object-position: center 30%; transform: scale(1.5);">
              </div>
              <div>
                <h1 class="text-xl font-bold gradient-text">Cowch</h1>
                <p class="text-xs" style="color: var(--color-text-secondary);">AI wellness coaching</p>
              </div>
            </div>
            <!-- Mobile badge -->
            <div class="sm:hidden badge text-xs">
              ‚ú® AI Therapy
            </div>
            <!-- Desktop badge -->
            <div class="hidden sm:block badge">
              ‚ú® AI Pastoral Care
            </div>
          </div>
        </div>
      </nav>

      <!-- Soothing Message Popup -->
      <transition name="fade">
        <div v-if="showSoothingPopup"
             style="position: fixed; bottom: 2rem; right: 2rem; z-index: 1000; max-width: 400px;
                    background: var(--color-accent-primary); color: white;
                    padding: 1.5rem 2rem; border-radius: 0.75rem;
                    box-shadow: 0 8px 30px rgba(238, 112, 26, 0.3);
                    border: 1px solid rgba(255, 255, 255, 0.2);">
          <p style="font-weight: 500; margin: 0; font-size: 0.95rem;">{{ currentSoothingMessage }}</p>
        </div>
      </transition>

      <!-- Main Content -->
      <main class="pt-24 pb-24">
        <div class="mx-auto px-6" style="max-width: var(--content-max-width);">
          
          <!-- Hero Section -->
          <div class="text-center" v-if="currentView === 'home'" style="margin-bottom: var(--section-gap);">
            <!-- Featured AI Mandy Cow -->
            <div class="flex justify-center mb-8">
              <div class="relative">
                <div class="w-32 h-32 md:w-40 md:h-40 rounded-2xl shadow-xl animate-float"
                     style="border: 3px solid var(--color-accent-secondary); background: var(--color-bg-secondary);">
                  <div class="w-full h-full rounded-2xl overflow-hidden">
                    <img src="assets/theracowch_main_image.jpg" alt="AI Mandy - Your Therapeutic Cow Coach"
                         class="w-full h-full object-cover"
                         style="object-position: center 30%; transform: scale(1.5);">
                  </div>
                </div>
              </div>
            </div>

            <h1 class="text-4xl md:text-5xl font-bold mb-6 gradient-text" style="font-weight: 700;">
              Moove to the cowch
            </h1>
            <p class="text-xl mb-8 max-w-2xl mx-auto" style="color: var(--color-text-secondary); line-height: 1.7;">
              Come to the cowch with AI Mandy as your guide. Take a vaca-tion for your mind - no bull, just genuine support, encouragement, and pattern-matching to help build healthy habits for your mental wellness pasture
            </p>
            <div class="flex flex-col md:flex-row justify-center items-center" style="gap: var(--spacing-md);">
              <button @click="chatWithMandy" class="btn-primary w-full md:w-auto whitespace-nowrap text-lg px-16 py-6">
                <span class="emoji-bounce mr-4">üí¨</span>
                Shall we moove to the cowch?
              </button>
              <button @click="exploreImagine" class="btn-glass w-full md:w-auto whitespace-nowrap text-lg px-16 py-6">
                <span class="emoji-bounce mr-4">üß†</span>
                Explore IMAGINE Framework
              </button>
            </div>
          </div>

          <!-- Important Notice -->
          <div v-if="currentView === 'home'" class="text-center" style="margin-bottom: var(--section-gap);">
            <div class="glass-dark rounded-2xl p-6 max-w-4xl mx-auto border border-amber-400/30">
              <div class="flex items-start space-x-3">
                <div class="text-2xl">üíô</div>
                <div class="text-left">
                  <h3 class="text-lg font-semibold text-amber-200 mb-3">A Warm Note About Your Wellness Pasture</h3>
                  <div class="text-sm text-stone-300 space-y-2 leading-relaxed">
                    <p>AI Mandy provides <strong>wellness coaching</strong> with encouragement and pattern-matching insights to help build healthy habits. <strong>This is not professional therapy or medical care</strong> - just supportive coaching.</p>
                    <p><strong>For mental health crises</strong>, please contact qualified professionals or crisis helplines immediately.</p>
                    <p class="text-amber-200 font-medium">Your safe space for encouragement and positive habit-building! üêÑ</p>
                  </div>
                </div>
              </div>
            </div>
          </div>

          <!-- Daily Wisdom from Mandy -->
          <div v-if="currentView === 'home'" class="text-center" style="margin-bottom: var(--section-gap);">
            <div class="glass-dark rounded-2xl p-8 max-w-2xl mx-auto">
              <h2 class="text-2xl font-bold text-white mb-4">
                <span class="emoji-bounce mr-2">üåü</span>
                Daily Wisdom
              </h2>
              <div class="bg-gradient-to-r from-indigo-500/20 to-purple-500/20 rounded-xl p-6 border border-indigo-400/30">
                <div v-if="isLoadingQuote" class="text-center py-4">
                  <div class="text-stone-300">Loading wisdom from the pasture... üêÑ</div>
                </div>
                <div v-else-if="currentQuote">
                  <blockquote class="text-lg text-stone-200 italic mb-4">
                    "{{ currentQuote.text }}"
                  </blockquote>
                  <p class="text-stone-400 text-sm mb-4">
                    ‚Äî {{ currentQuote.author }}
                    <span v-if="currentQuote.source" class="text-stone-500">‚Ä¢ {{ currentQuote.source }}</span>
                  </p>
                </div>
                <button @click="getNewQuote" class="btn-glass text-sm px-4 py-2" :disabled="isLoadingQuote">
                  <span class="emoji-bounce mr-1">üîÑ</span>
                  {{ isLoadingQuote ? 'Loading...' : 'Get Another Mooo-tivation' }}
                </button>
              </div>
            </div>
          </div>

          <!-- IMAGINE Framework -->
          <div v-if="currentView === 'home' || currentView === 'imagine'">
            <div class="text-center" style="margin-bottom: var(--spacing-2xl);">
              <h2 class="text-2xl font-bold text-white" style="margin-bottom: var(--spacing-md);">The IMAGINE Framework</h2>
              <p class="text-stone-300">Seven evidence-based domains for legen-dairy mental wellness</p>
            </div>

            <div class="grid grid-cols-1 md:grid-cols-2 gap-6" style="margin-bottom: var(--section-gap);">
              <div v-for="(section, index) in imagineSections" 
                   :key="section.key"
                   @click="goToSection(section.key)"
                   class="imagine-card animate-fade-in-up"
                   :style="{ animationDelay: (index * 0.1) + 's' }">
                
                <div class="flex items-center relative z-10" style="gap: var(--spacing-md);">
                  <div class="flex-shrink-0">
                    <div class="w-18 h-18 rounded-2xl flex items-center justify-center text-3xl shadow-lg emoji-bounce relative overflow-hidden"
                         :style="'background: ' + section.gradient + '; box-shadow: 0 12px 30px ' + section.shadowColor + ', 0 0 20px ' + section.shadowColor + ', inset 0 1px 0 rgba(255,255,255,0.3)'">
                      {{ section.emoji }}
                      <div class="absolute inset-0 bg-gradient-to-tr from-white/20 to-transparent rounded-2xl"></div>
                    </div>
                  </div>
                  <div class="flex-1">
                    <h3 class="text-lg font-semibold text-white mb-2 group-hover:text-indigo-200 transition-colors">{{ section.title }}</h3>
                    <p class="text-sm text-stone-300 group-hover:text-stone-200 transition-colors">{{ section.subtitle }}</p>
                  </div>
                  <div class="text-stone-400 group-hover:text-indigo-300 transition-all duration-300 group-hover:scale-110">
                    <svg width="24" height="24" viewBox="0 0 24 24" fill="currentColor" class="drop-shadow-sm">
                      <path d="M8.59 16.59L13.17 12 8.59 7.41 10 6l6 6-6 6-1.41-1.41z"/>
                    </svg>
                  </div>
                </div>
              </div>
            </div>
          </div>

          <!-- Chat Interface -->
          <div v-if="currentView === 'chat'" class="flex flex-col h-screen">
            <!-- Chat Header -->
            <div class="flex items-center px-4 py-3 glass-dark border-b border-white/10">
              <div class="flex items-center" style="gap: var(--spacing-sm);">
                <div class="w-10 h-10 rounded-full bg-gradient-to-r from-orange-400 to-red-400 flex items-center justify-center overflow-hidden shadow-lg border-2 border-white/20">
                  <img src="assets/theracowch_main_image.jpg" alt="AI Mandy" class="w-full h-full object-cover"
                       style="object-position: center 30%; transform: scale(1.5);">
                </div>
                <div>
                  <h3 class="font-semibold text-white">AI Mandy</h3>
                  <p class="text-sm text-stone-400">Your Pasturel Coach</p>
                </div>
              </div>
            </div>

            <!-- Chat Messages -->
            <div id="chat-messages" class="flex-1 overflow-y-auto px-4 py-4" style="display: flex; flex-direction: column; gap: var(--spacing-md);">
              <div v-for="message in chatHistory" :key="message.id"
                   class="flex" :class="message.sender === 'user' ? 'justify-end mr-2' : 'justify-start ml-2 mr-8'">
                <div class="px-4 py-3 rounded-2xl"
                     :class="message.sender === 'user'
                       ? 'bg-gradient-to-r from-indigo-500 to-purple-500 text-white max-w-xs mr-2'
                       : 'bg-gradient-to-r from-orange-400 to-red-400 text-white max-w-sm ml-2'">
                  {{ message.text }}
                </div>
              </div>

              <div v-if="isTyping" class="flex justify-start ml-2 mr-8">
                <div class="bg-gradient-to-r from-orange-400 to-red-400 text-white px-4 py-3 rounded-2xl max-w-sm ml-2">
                  <div class="flex" style="gap: var(--spacing-xs);">
                    <div class="w-2 h-2 bg-white/60 rounded-full animate-pulse"></div>
                    <div class="w-2 h-2 bg-white/60 rounded-full animate-pulse" style="animation-delay: 0.1s"></div>
                    <div class="w-2 h-2 bg-white/60 rounded-full animate-pulse" style="animation-delay: 0.2s"></div>
                  </div>
                </div>
              </div>
            </div>

            <!-- Message Input -->
            <div class="px-4 py-4 glass-dark border-t border-white/10">
              <div class="flex" style="gap: var(--spacing-sm);">
                <input v-model="newMessage" @keyup.enter="sendMessage"
                       placeholder="Share what's on your mind..."
                       class="input-field flex-1">
                <button @click="sendMessage" class="btn-primary px-6">
                  Send
                </button>
              </div>
            </div>
          </div>

          <!-- Mood Tracker -->
          <div v-if="currentView === 'mood'" class="card max-w-2xl mx-auto">
            <div class="text-center" style="margin-bottom: var(--spacing-xl);">
              <h2 class="text-2xl font-bold text-white" style="margin-bottom: var(--spacing-md);">How are you MOO-ving today?</h2>
              <p class="text-stone-300">Track your mood with our cow faces to identify patterns and moo-gress</p>
            </div>
            
            <div class="grid grid-cols-5 mb-8" style="gap: var(--spacing-md);">
              <button v-for="mood in moodOptions" :key="mood.value"
                      @click="selectMood(mood.value)"
                      class="flex flex-col items-center p-4 rounded-xl transition-all duration-200 hover:scale-105"
                      :class="selectedMood === mood.value ? 'glass bg-indigo-500/20 border-indigo-400' : 'glass-dark hover:bg-white/10'">
                <span class="text-3xl mb-2">{{ mood.emoji }}</span>
                <span class="text-xs font-medium text-center">{{ mood.label }}</span>
              </button>
            </div>
            
            <div style="display: flex; flex-direction: column; gap: var(--spacing-md);">
              <textarea v-model="moodNote" 
                        placeholder="What's contributing to this feeling? (optional)"
                        class="input-field min-h-[100px] resize-none"></textarea>
              
              <button @click="saveMoodEntry" class="btn-primary w-full"
                      :disabled="!selectedMood">
                Save MOO-d Entry
              </button>
              
              <button @click="chatWithMandy" class="btn-glass w-full">
                üí¨ Talk to AI Mandy about this
              </button>
            </div>
          </div>

          <!-- Section Detail -->
          <div v-if="currentView === 'section' && currentSection" class="card max-w-2xl mx-auto">
            <div class="flex items-center justify-between mb-6">
              <div class="flex items-center" style="gap: var(--spacing-sm);">
                <div class="w-12 h-12 rounded-2xl flex items-center justify-center text-xl"
                     :style="'background: ' + currentSection.gradient">
                  {{ currentSection.emoji }}
                </div>
                <div>
                  <h2 class="text-xl font-bold text-white">{{ currentSection.title }}</h2>
                  <p class="text-stone-300">{{ currentSection.subtitle }}</p>
                </div>
              </div>
              <button @click="goHome" class="btn-small">
                ‚Üê Back
              </button>
            </div>

            <div style="display: flex; flex-direction: column; gap: var(--spacing-xl);">
              <div class="glass-dark p-4 rounded-xl">
                <h3 class="font-semibold text-white mb-2">Cow-dance</h3>
                <p class="text-stone-300">{{ getSectionGuidance(currentSection.key) }}</p>
              </div>

              <div class="grid grid-cols-1" style="gap: var(--spacing-md);">
                <div v-for="tool in getSectionTools(currentSection.key)" :key="tool.id"
                     @click="startExercise(tool)"
                     class="glass-dark p-4 rounded-xl cursor-pointer hover:bg-white/10 transition-all group">
                  <div class="flex items-center justify-between">
                    <div class="flex items-center" style="gap: var(--spacing-sm);">
                      <span class="text-xl">{{ tool.icon }}</span>
                      <div>
                        <h4 class="font-medium text-white">{{ tool.name }}</h4>
                        <p class="text-sm text-stone-400">{{ tool.description }}</p>
                      </div>
                    </div>
                    <div class="text-stone-400 group-hover:text-indigo-300 transition-colors">
                      <svg width="20" height="20" viewBox="0 0 24 24" fill="currentColor">
                        <path d="M8 5v14l11-7z"/>
                      </svg>
                    </div>
                  </div>
                </div>
              </div>

              <button @click="chatWithMandy" class="btn-primary w-full">
                üí¨ Discuss This with AI Mandy
              </button>
            </div>
          </div>

          <!-- Exercise Interface -->
          <div v-if="currentView === 'exercise' && currentExercise" class="card max-w-2xl mx-auto">
            <div class="flex items-center justify-between mb-6">
              <div class="flex items-center" style="gap: var(--spacing-sm);">
                <div class="w-12 h-12 rounded-2xl flex items-center justify-center text-xl"
                     :style="'background: ' + currentSection.gradient">
                  {{ currentExercise.icon }}
                </div>
                <div>
                  <h2 class="text-xl font-bold text-white">{{ currentExercise.name }}</h2>
                  <p class="text-stone-300">{{ currentSection.title }}</p>
                </div>
              </div>
              <button @click="goBackToSection" class="btn-small">
                ‚Üê Back
              </button>
            </div>

            <!-- Dynamic Exercise Content -->
            <div style="display: flex; flex-direction: column; gap: var(--spacing-xl);">
              
              <!-- 5-4-3-2-1 Grounding Exercise -->
              <div v-if="currentExercise.id === 'grounding_5432' && currentSection.key === 'mindfulness'">
                <div class="glass-dark rounded-xl" style="padding: var(--card-padding);">
                  <h3 class="font-semibold text-white" style="margin-bottom: var(--spacing-md);">5-4-3-2-1 Sense-ational Vaca-tion</h3>
                  <p class="text-stone-300" style="margin-bottom: var(--spacing-xl);">Take a quick vaca-tion for your mind by connecting with the present moment through your senses.</p>
                  
                  <div style="display: flex; flex-direction: column; gap: var(--spacing-md);">
                    <div v-for="(step, index) in groundingSteps" :key="index" 
                         class="p-4 rounded-lg transition-all duration-300"
                         :class="currentGroundingStep === index ? 'bg-indigo-500/20 border border-indigo-400/50' : 'bg-white/5'">
                      <div class="flex items-center" style="gap: var(--spacing-sm);">
                        <div class="w-8 h-8 rounded-full flex items-center justify-center text-sm font-bold"
                             :class="currentGroundingStep === index ? 'bg-indigo-500 text-white' : 'bg-stone-600 text-stone-300'">
                          {{ step.number }}
                        </div>
                        <div>
                          <h4 class="font-medium text-white">{{ step.title }}</h4>
                          <p class="text-sm text-stone-400">{{ step.description }}</p>
                        </div>
                      </div>
                      
                      <div v-if="currentGroundingStep === index" class="mt-4 pl-11">
                        <div class="space-y-2">
                          <div v-for="(item, itemIndex) in step.items" :key="itemIndex" 
                               class="flex items-center" style="gap: var(--spacing-xs);">
                            <input type="checkbox" :id="`item-${index}-${itemIndex}`" 
                                   @change="checkGroundingItem(index, itemIndex)"
                                   class="rounded border-stone-600 bg-stone-700 text-indigo-500 focus:ring-indigo-500">
                            <label :for="`item-${index}-${itemIndex}`" class="text-sm text-stone-300">{{ item }}</label>
                          </div>
                        </div>
                        
                        <button v-if="canAdvanceGrounding(index)" 
                                @click="nextGroundingStep" 
                                class="btn-small mt-4">
                          {{ index === groundingSteps.length - 1 ? 'Complete Exercise' : 'Next Step' }}
                        </button>
                      </div>
                    </div>
                  </div>
                </div>
              </div>

              <!-- Breathing Exercise -->
              <div v-if="currentExercise.id === 'breathing_4_7_8' && currentSection.key === 'mindfulness'">
                <div class="glass-dark rounded-xl text-center" style="padding: var(--card-padding);">
                  <h3 class="font-semibold text-white" style="margin-bottom: var(--spacing-md);">4-7-8 Vaca-tion Breathing</h3>
                  <p class="text-stone-300" style="margin-bottom: var(--spacing-xl);">Take a mini vaca-tion for your mind with this calming breath pattern to reduce anxiety and promote relaxation.</p>
                  
                  <div class="mb-8">
                    <div class="w-32 h-32 mx-auto rounded-full border-4 border-indigo-400/30 flex items-center justify-center relative overflow-hidden"
                         :class="{ 'animate-pulse': breathingActive }">
                      <div class="absolute inset-0 bg-gradient-to-r from-indigo-500/20 to-purple-500/20 rounded-full"
                           :class="breathingPhase === 'inhale' ? 'scale-110' : breathingPhase === 'hold' ? 'scale-105' : 'scale-95'"
                           :style="{ transition: 'transform ' + breathingDuration + 'ms ease-in-out' }"></div>
                      <div class="relative z-10">
                        <div class="text-2xl font-bold text-white">{{ breathingCount }}</div>
                        <div class="text-sm text-stone-300 capitalize">{{ breathingPhase }}</div>
                      </div>
                    </div>
                  </div>
                  
                  <div style="display: flex; flex-direction: column; gap: var(--spacing-md);">
                    <div class="text-stone-300">
                      <p>Round {{ currentBreathRound }} of {{ totalBreathRounds }}</p>
                    </div>
                    
                    <div class="flex justify-center" style="gap: var(--spacing-md);">
                      <button v-if="!breathingActive" @click="startBreathing" class="btn-primary px-6 py-3">
                        üèñÔ∏è Start Your Mind Vaca-tion
                      </button>
                      <button v-if="breathingActive" @click="stopBreathing" class="btn-glass px-6 py-3">
                        ‚è∏Ô∏è Pause
                      </button>
                    </div>
                  </div>
                </div>
              </div>

              <!-- Self-Care Energy Audit -->
              <div v-if="currentExercise.id === 'energy_audit' && currentSection.key === 'self_care'">
                <div class="glass-dark rounded-xl" style="padding: var(--card-padding);">
                  <h3 class="font-semibold text-white" style="margin-bottom: var(--spacing-md);">Energy Audit</h3>
                  <p class="text-stone-300" style="margin-bottom: var(--spacing-xl);">Identify what gives you energy vs. what drains it.</p>
                  
                  <div class="grid grid-cols-1 md:grid-cols-2" style="gap: var(--spacing-xl);">
                    <div style="display: flex; flex-direction: column; gap: var(--spacing-md);">
                      <h4 class="font-medium text-white flex items-center" style="gap: var(--spacing-xs);">
                        <span>‚ö°</span>
                        <span>Energy Givers</span>
                      </h4>
                      <div class="space-y-2">
                        <div v-for="(giver, index) in energyGivers" :key="index"
                             class="flex items-center" style="gap: var(--spacing-xs);">
                          <span class="text-green-400">+</span>
                          <span class="text-stone-300 text-sm">{{ giver }}</span>
                        </div>
                      </div>
                      <div class="flex" style="gap: var(--spacing-xs);">
                        <input v-model="newEnergyGiver" 
                               @keyup.enter="addEnergyGiver"
                               placeholder="What gives you energy?"
                               class="input-field flex-1 text-sm">
                        <button @click="addEnergyGiver" class="btn-small">Add</button>
                      </div>
                    </div>
                    
                    <div style="display: flex; flex-direction: column; gap: var(--spacing-md);">
                      <h4 class="font-medium text-white flex items-center" style="gap: var(--spacing-xs);">
                        <span>üîã</span>
                        <span>Energy Drains</span>
                      </h4>
                      <div class="space-y-2">
                        <div v-for="(drain, index) in energyDrains" :key="index"
                             class="flex items-center" style="gap: var(--spacing-xs);">
                          <span class="text-red-400">-</span>
                          <span class="text-stone-300 text-sm">{{ drain }}</span>
                        </div>
                      </div>
                      <div class="flex" style="gap: var(--spacing-xs);">
                        <input v-model="newEnergyDrain" 
                               @keyup.enter="addEnergyDrain"
                               placeholder="What drains your energy?"
                               class="input-field flex-1 text-sm">
                        <button @click="addEnergyDrain" class="btn-small">Add</button>
                      </div>
                    </div>
                  </div>
                </div>
              </div>

              <!-- Gratitude Practice -->
              <div v-if="currentExercise.id === 'three_good_things' && currentSection.key === 'gratitude'">
                <div class="glass-dark rounded-xl" style="padding: var(--card-padding);">
                  <h3 class="font-semibold text-white" style="margin-bottom: var(--spacing-md);">Three Good Things</h3>
                  <p class="text-stone-300" style="margin-bottom: var(--spacing-xl);">Write down three things that went well today and why they were meaningful.</p>
                  
                  <div style="display: flex; flex-direction: column; gap: var(--spacing-xl);">
                    <div v-for="(thing, index) in threeGoodThings" :key="index" class="space-y-3">
                      <h4 class="font-medium text-white">Good Thing #{{ index + 1 }}</h4>
                      <textarea v-model="thing.what" 
                                :placeholder="`What was the ${index + 1}${index === 0 ? 'st' : index === 1 ? 'nd' : 'rd'} good thing?`"
                                class="input-field w-full h-20 resize-none text-sm"></textarea>
                      <textarea v-model="thing.why" 
                                placeholder="Why was this meaningful to you?"
                                class="input-field w-full h-16 resize-none text-sm"></textarea>
                    </div>
                    
                    <button @click="saveGratitudeEntry" 
                            :disabled="!canSaveGratitude"
                            class="btn-primary w-full"
                            :class="{ 'opacity-50 cursor-not-allowed': !canSaveGratitude }">
                      üíù Save Gratitude Entry
                    </button>
                  </div>
                </div>
              </div>

              <!-- Thought Unhooking Exercise (Acceptance) -->
              <div v-if="currentExercise.id === 'thought_unhooking' && currentSection.key === 'acceptance'">
                <div class="glass-dark rounded-xl" style="padding: var(--card-padding);">
                  <h3 class="font-semibold text-white" style="margin-bottom: var(--spacing-md);">Thought Unhooking</h3>
                  <p class="text-stone-300" style="margin-bottom: var(--spacing-xl);">Learn to detach from anxious thoughts by treating them like scenes from a movie.</p>
                  
                  <div style="display: flex; flex-direction: column; gap: var(--spacing-xl);">
                    <div style="display: flex; flex-direction: column; gap: var(--spacing-md);">
                      <h4 class="font-medium text-white">What thought is bothering you right now?</h4>
                      <textarea v-model="currentBotherThought" 
                                placeholder="Write the specific thought that's causing anxiety or distress..."
                                class="input-field w-full h-20 resize-none text-sm"></textarea>
                    </div>
                    
                    <div v-if="currentBotherThought.trim()" style="display: flex; flex-direction: column; gap: var(--spacing-md);">
                      <h4 class="font-medium text-white">Now, let's unhook from this thought:</h4>
                      
                      <div class="space-y-3">
                        <div class="p-4 bg-purple-500/10 border border-purple-400/30 rounded-lg">
                          <h5 class="font-medium text-purple-300 mb-2">üé¨ Movie Scene Technique</h5>
                          <p class="text-sm text-stone-300 mb-3">Imagine this thought is just a scene playing in a movie. You're watching it, but you're not in it.</p>
                          <p class="text-sm text-purple-200 italic">"I'm watching the thought: '{{ currentBotherThought }}' - but it's just a movie scene, not reality."</p>
                        </div>
                        
                        <div class="p-4 bg-blue-500/10 border border-blue-400/30 rounded-lg">
                          <h5 class="font-medium text-blue-300 mb-2">üè∑Ô∏è Label It Technique</h5>
                          <p class="text-sm text-stone-300 mb-3">Give this thought a simple, non-judgmental label.</p>
                          <div class="flex" style="gap: var(--spacing-xs);">
                            <button v-for="label in thoughtLabels" :key="label"
                                    @click="selectedThoughtLabel = label"
                                    class="px-3 py-1 rounded-full text-xs transition-all"
                                    :class="selectedThoughtLabel === label ? 'bg-blue-500 text-white' : 'bg-blue-500/20 text-blue-300 hover:bg-blue-500/40'">
                              {{ label }}
                            </button>
                          </div>
                          <p v-if="selectedThoughtLabel" class="text-sm text-blue-200 mt-3 italic">
                            "I notice I'm having a {{ selectedThoughtLabel.toLowerCase() }} thought. That's just what minds do."
                          </p>
                        </div>
                        
                        <div class="p-4 bg-green-500/10 border border-green-400/30 rounded-lg">
                          <h5 class="font-medium text-green-300 mb-2">üîÑ Reframe Question</h5>
                          <p class="text-sm text-stone-300 mb-3">Ask yourself: "What can I actually do to improve this situation?"</p>
                          <textarea v-model="actionableReframe" 
                                    placeholder="Write one small, practical action you could take..."
                                    class="input-field w-full h-16 resize-none text-sm bg-green-500/5"></textarea>
                        </div>
                      </div>
                      
                      <button @click="completeThoughtUnhooking" 
                              :disabled="!actionableReframe.trim()"
                              class="btn-primary w-full"
                              :class="{ 'opacity-50 cursor-not-allowed': !actionableReframe.trim() }">
                        üéØ Complete Thought Unhooking
                      </button>
                    </div>
                  </div>
                </div>
              </div>

              <!-- Values Compass Exercise (Exploring) -->
              <div v-if="currentExercise.id === 'values_compass' && currentSection.key === 'exploring'">
                <div class="glass-dark rounded-xl" style="padding: var(--card-padding);">
                  <h3 class="font-semibold text-white" style="margin-bottom: var(--spacing-md);">Values Compass</h3>
                  <p class="text-stone-300" style="margin-bottom: var(--spacing-xl);">Identify your core values to guide decision-making and understand behavior patterns.</p>
                  
                  <div style="display: flex; flex-direction: column; gap: var(--spacing-xl);">
                    <div class="grid grid-cols-2 md:grid-cols-3 gap-3">
                      <div v-for="value in availableValues" :key="value"
                           @click="toggleValue(value)"
                           class="p-3 rounded-lg border cursor-pointer transition-all text-center text-sm"
                           :class="selectedValues.includes(value) ? 
                             'border-indigo-400 bg-indigo-500/20 text-indigo-200' : 
                             'border-stone-600 bg-stone-700/50 text-stone-300 hover:border-stone-500'">
                        {{ value }}
                      </div>
                    </div>
                    
                    <div v-if="selectedValues.length > 0" style="display: flex; flex-direction: column; gap: var(--spacing-md);">
                      <h4 class="font-medium text-white">Your Top Values ({{ selectedValues.length }}/5 max)</h4>
                      <div class="space-y-3">
                        <div v-for="value in selectedValues" :key="value" class="p-3 bg-indigo-500/10 border border-indigo-400/30 rounded-lg">
                          <div class="flex items-center justify-between mb-2">
                            <span class="font-medium text-indigo-200">{{ value }}</span>
                            <button @click="removeValue(value)" class="text-stone-400 hover:text-stone-200">√ó</button>
                          </div>
                          <textarea v-model="valueReflections[value]" 
                                    :placeholder="`Why is ${value.toLowerCase()} important to you?`"
                                    class="input-field w-full h-12 resize-none text-xs bg-indigo-500/5"></textarea>
                        </div>
                      </div>
                      
                      <button @click="completeValuesExploration" 
                              :disabled="!canCompleteValues"
                              class="btn-primary w-full"
                              :class="{ 'opacity-50 cursor-not-allowed': !canCompleteValues }">
                        üß≠ Save My Values Compass
                      </button>
                    </div>
                    
                    <div v-if="selectedValues.length === 0" class="text-center py-4">
                      <p class="text-stone-400">Select values that resonate most deeply with you (up to 5)</p>
                    </div>
                  </div>
                </div>
              </div>

              <!-- Connection Web Exercise (Interactions) -->
              <div v-if="currentExercise.id === 'connection_web' && currentSection.key === 'interactions'">
                <div class="glass-dark rounded-xl" style="padding: var(--card-padding);">
                  <h3 class="font-semibold text-white" style="margin-bottom: var(--spacing-md);">Connection Web</h3>
                  <p class="text-stone-300" style="margin-bottom: var(--spacing-xl);">Map your relationships and plan meaningful ways to strengthen connections.</p>
                  
                  <div style="display: flex; flex-direction: column; gap: var(--spacing-xl);">
                    <div class="grid grid-cols-1 md:grid-cols-2" style="gap: var(--spacing-xl);">
                      <!-- Inner Circle -->
                      <div style="display: flex; flex-direction: column; gap: var(--spacing-md);">
                        <h4 class="font-medium text-white flex items-center" style="gap: var(--spacing-xs);">
                          <span>üíù</span>
                          <span>Inner Circle (Closest People)</span>
                        </h4>
                        <div class="space-y-2">
                          <div v-for="(person, index) in innerCircle" :key="index"
                               class="flex items-center justify-between p-2 bg-pink-500/10 border border-pink-400/30 rounded">
                            <span class="text-pink-200 text-sm">{{ person }}</span>
                            <button @click="removeFromCircle('inner', index)" class="text-stone-400 hover:text-stone-200">√ó</button>
                          </div>
                        </div>
                        <div class="flex" style="gap: var(--spacing-xs);">
                          <input v-model="newInnerPerson" 
                                 @keyup.enter="addToInnerCircle"
                                 placeholder="Add someone close to you"
                                 class="input-field flex-1 text-sm">
                          <button @click="addToInnerCircle" class="btn-small">Add</button>
                        </div>
                      </div>
                      
                      <!-- Wider Network -->
                      <div style="display: flex; flex-direction: column; gap: var(--spacing-md);">
                        <h4 class="font-medium text-white flex items-center" style="gap: var(--spacing-xs);">
                          <span>üåê</span>
                          <span>Wider Network</span>
                        </h4>
                        <div class="space-y-2">
                          <div v-for="(person, index) in widerNetwork" :key="index"
                               class="flex items-center justify-between p-2 bg-blue-500/10 border border-blue-400/30 rounded">
                            <span class="text-blue-200 text-sm">{{ person }}</span>
                            <button @click="removeFromCircle('wider', index)" class="text-stone-400 hover:text-stone-200">√ó</button>
                          </div>
                        </div>
                        <div class="flex" style="gap: var(--spacing-xs);">
                          <input v-model="newWiderPerson" 
                                 @keyup.enter="addToWiderNetwork"
                                 placeholder="Add acquaintance or colleague"
                                 class="input-field flex-1 text-sm">
                          <button @click="addToWiderNetwork" class="btn-small">Add</button>
                        </div>
                      </div>
                    </div>
                    
                    <div v-if="innerCircle.length > 0 || widerNetwork.length > 0" style="display: flex; flex-direction: column; gap: var(--spacing-md);">
                      <h4 class="font-medium text-white">Connection Action Plan</h4>
                      <div class="grid grid-cols-1 md:grid-cols-3" style="gap: var(--spacing-md);">
                        <div class="p-4 bg-green-500/10 border border-green-400/30 rounded-lg">
                          <h5 class="font-medium text-green-300 mb-2">üíå This Week</h5>
                          <textarea v-model="connectionPlan.thisWeek" 
                                    placeholder="One person to reach out to this week..."
                                    class="input-field w-full h-16 resize-none text-xs bg-green-500/5"></textarea>
                        </div>
                        <div class="p-4 bg-yellow-500/10 border border-yellow-400/30 rounded-lg">
                          <h5 class="font-medium text-yellow-300 mb-2">üìÖ This Month</h5>
                          <textarea v-model="connectionPlan.thisMonth" 
                                    placeholder="Someone to make deeper plans with..."
                                    class="input-field w-full h-16 resize-none text-xs bg-yellow-500/5"></textarea>
                        </div>
                        <div class="p-4 bg-purple-500/10 border border-purple-400/30 rounded-lg">
                          <h5 class="font-medium text-purple-300 mb-2">üéØ New Connection</h5>
                          <textarea v-model="connectionPlan.newConnection" 
                                    placeholder="How could you meet someone new?"
                                    class="input-field w-full h-16 resize-none text-xs bg-purple-500/5"></textarea>
                        </div>
                      </div>
                      
                      <button @click="completeConnectionWeb" 
                              :disabled="!canCompleteConnection"
                              class="btn-primary w-full"
                              :class="{ 'opacity-50 cursor-not-allowed': !canCompleteConnection }">
                        üï∏Ô∏è Save My Connection Web
                      </button>
                    </div>
                  </div>
                </div>
              </div>

              <!-- Joy Jar Exercise (Nurturing) -->
              <div v-if="currentExercise.id === 'joy_jar' && currentSection.key === 'nurturing'">
                <div class="glass-dark rounded-xl" style="padding: var(--card-padding);">
                  <h3 class="font-semibold text-white" style="margin-bottom: var(--spacing-md);">Digital Joy Jar</h3>
                  <p class="text-stone-300" style="margin-bottom: var(--spacing-xl);">Collect moments of joy, fun, and playfulness to revisit when life feels too serious.</p>
                  
                  <div style="display: flex; flex-direction: column; gap: var(--spacing-xl);">
                    <div style="display: flex; flex-direction: column; gap: var(--spacing-md);">
                      <h4 class="font-medium text-white">Add a Joy Moment</h4>
                      <div class="grid grid-cols-1 md:grid-cols-3" style="gap: var(--spacing-md);">
                        <div>
                          <label class="block text-sm text-stone-400 mb-1">Type of Joy</label>
                          <select v-model="currentJoyEntry.type" class="input-field w-full text-sm">
                            <option value="">Select type...</option>
                            <option value="silly">ü§™ Silly Moment</option>
                            <option value="beautiful">üòç Something Beautiful</option>
                            <option value="achievement">üèÜ Small Win</option>
                            <option value="connection">üíï Heart Connection</option>
                            <option value="surprise">üéâ Pleasant Surprise</option>
                            <option value="nature">üå± Nature Joy</option>
                            <option value="creativity">üé® Creative Fun</option>
                            <option value="kindness">ü§ó Act of Kindness</option>
                          </select>
                        </div>
                        <div>
                          <label class="block text-sm text-stone-400 mb-1">When</label>
                          <select v-model="currentJoyEntry.when" class="input-field w-full text-sm">
                            <option value="today">Today</option>
                            <option value="yesterday">Yesterday</option>
                            <option value="this-week">This Week</option>
                            <option value="recently">Recently</option>
                          </select>
                        </div>
                        <div>
                          <label class="block text-sm text-stone-400 mb-1">Joy Level</label>
                          <div class="flex" style="gap: var(--spacing-xs);">
                            <button v-for="level in 5" :key="level"
                                    @click="currentJoyEntry.level = level"
                                    class="w-8 h-8 rounded-full border-2 transition-all"
                                    :class="currentJoyEntry.level >= level ? 
                                      'border-yellow-400 bg-yellow-400/20 text-yellow-300' : 
                                      'border-stone-600 text-stone-500 hover:border-stone-500'">
                              ‚≠ê
                            </button>
                          </div>
                        </div>
                      </div>
                      
                      <textarea v-model="currentJoyEntry.description" 
                                placeholder="Describe this joyful moment... What made it special? How did it feel?"
                                class="input-field w-full h-20 resize-none text-sm"></textarea>
                      
                      <button @click="addJoyMoment" 
                              :disabled="!canAddJoy"
                              class="btn-primary w-full"
                              :class="{ 'opacity-50 cursor-not-allowed': !canAddJoy }">
                        ‚ú® Add to Joy Jar
                      </button>
                    </div>
                    
                    <div v-if="joyJar.length > 0" style="display: flex; flex-direction: column; gap: var(--spacing-md);">
                      <div class="flex items-center justify-between">
                        <h4 class="font-medium text-white">Your Joy Collection ({{ joyJar.length }})</h4>
                        <button @click="getRandomJoy" class="btn-small">
                          üé≤ Random Joy
                        </button>
                      </div>
                      
                      <div class="max-h-64 overflow-y-auto space-y-3">
                        <div v-for="(joy, index) in joyJar" :key="index" 
                             class="p-3 rounded-lg border transition-all"
                             :class="randomJoyIndex === index ? 
                               'border-yellow-400 bg-yellow-400/10 shadow-lg' : 
                               'border-stone-600 bg-stone-700/30'">
                          <div class="flex items-start justify-between mb-2">
                            <div class="flex items-center" style="gap: var(--spacing-xs);">
                              <span class="text-lg">{{ getJoyEmoji(joy.type) }}</span>
                              <span class="text-sm text-stone-400 capitalize">{{ joy.when }}</span>
                              <div class="flex">
                                <span v-for="n in joy.level" :key="n" class="text-yellow-400 text-xs">‚≠ê</span>
                              </div>
                            </div>
                            <button @click="removeJoy(index)" class="text-stone-500 hover:text-stone-300 text-sm">√ó</button>
                          </div>
                          <p class="text-stone-300 text-sm">{{ joy.description }}</p>
                        </div>
                      </div>
                    </div>
                  </div>
                </div>
              </div>

              <!-- Wellness Check-In (Self-Care) -->
              <div v-if="currentExercise.id === 'wellness_checkin' && currentSection.key === 'self_care'">
                <div class="glass-dark rounded-xl" style="padding: var(--card-padding);">
                  <h3 class="font-semibold mb-4" style="color: var(--color-text-dark);">Wellness Check-In</h3>
                  <p class="mb-6" style="color: var(--color-text-secondary);">Rate each area of your wellness to identify what needs more focus</p>

                  <div style="display: flex; flex-direction: column; gap: var(--spacing-xl);">
                    <div>
                      <label class="block text-sm font-medium mb-2" style="color: var(--color-text-primary);">Mood Level (1=very low, 10=very contented)</label>
                      <input type="range" v-model.number="wellnessMood" min="1" max="10" class="w-full">
                      <div class="text-center mt-1" style="color: var(--color-accent-primary); font-weight: 600;">{{ wellnessMood }}/10</div>
                      <p v-if="wellnessMood < 6" class="text-sm mt-2" style="color: var(--color-text-secondary);">
                        üí° To raise your mood one point, try: walking, listening to happy music, calling a friend, playing with a pet, or thinking about something that makes you smile
                      </p>
                    </div>

                    <div>
                      <label class="block text-sm font-medium mb-2" style="color: var(--color-text-primary);">Exercise Satisfaction (1-10)</label>
                      <input type="range" v-model.number="wellnessExercise" min="1" max="10" class="w-full">
                      <div class="text-center mt-1" style="color: var(--color-accent-primary); font-weight: 600;">{{ wellnessExercise }}/10</div>
                    </div>

                    <div>
                      <label class="block text-sm font-medium mb-2" style="color: var(--color-text-primary);">Diet Satisfaction (1-10)</label>
                      <input type="range" v-model.number="wellnessDiet" min="1" max="10" class="w-full">
                      <div class="text-center mt-1" style="color: var(--color-accent-primary); font-weight: 600;">{{ wellnessDiet }}/10</div>
                    </div>

                    <div>
                      <label class="block text-sm font-medium mb-2" style="color: var(--color-text-primary);">Appearance & Self-Care (1-10)</label>
                      <input type="range" v-model.number="wellnessAppearance" min="1" max="10" class="w-full">
                      <div class="text-center mt-1" style="color: var(--color-accent-primary); font-weight: 600;">{{ wellnessAppearance }}/10</div>
                      <p class="text-sm mt-1" style="color: var(--color-text-secondary);">Hygiene, physical & mental health care</p>
                    </div>

                    <div>
                      <label class="block text-sm font-medium mb-2" style="color: var(--color-text-primary);">Improvement Ideas</label>
                      <textarea v-model="wellnessImprovements"
                                placeholder="What could you do to improve areas scoring below 6? (e.g., Go to gym twice per week, eat salad once per week, book a massage)"
                                class="input-field w-full h-24 resize-none"></textarea>
                    </div>

                    <button @click="saveWellnessCheckin" class="btn-primary w-full">
                      ‚úÖ Complete Check-In
                    </button>
                  </div>
                </div>
              </div>

              <!-- Fun Prompt Generator (Nurturing) -->
              <div v-if="currentExercise.id === 'fun_prompt_generator' && currentSection.key === 'nurturing'">
                <div class="glass-dark rounded-xl" style="padding: var(--card-padding);">
                  <h3 class="font-semibold mb-4" style="color: var(--color-text-dark);">Fun Prompt Generator</h3>
                  <p class="mb-6" style="color: var(--color-text-secondary);">Get a random playful activity to add lightness to your day!</p>

                  <div v-if="!currentFunPrompt" class="text-center py-8">
                    <div class="text-6xl mb-4">üé≤</div>
                    <button @click="generateFunPrompt" class="btn-primary">
                      Get My Fun Prompt
                    </button>
                  </div>

                  <div v-else style="display: flex; flex-direction: column; gap: var(--spacing-lg);">
                    <div class="p-6 rounded-xl text-center" style="background: var(--color-bg-accent); border: 2px solid var(--color-accent-secondary);">
                      <div class="text-4xl mb-4">üéâ</div>
                      <p class="text-xl font-semibold mb-2" style="color: var(--color-accent-primary);">{{ currentFunPrompt }}</p>
                    </div>

                    <div v-if="!funPromptDone">
                      <label class="block text-sm font-medium mb-2" style="color: var(--color-text-primary);">How did it feel?</label>
                      <textarea v-model="funPromptFeeling"
                                placeholder="Describe how this made you feel..."
                                class="input-field w-full h-20 resize-none mb-4"></textarea>
                      <button @click="completeFunPrompt" class="btn-primary w-full">
                        ‚úÖ I Did It!
                      </button>
                    </div>

                    <div v-else class="text-center p-4 rounded-lg" style="background: var(--color-bg-accent);">
                      <p class="font-semibold mb-2" style="color: var(--color-accent-primary);">üéä Fantastic! Playfulness is vital for mental wellness</p>
                      <button @click="generateFunPrompt" class="btn-glass mt-4">
                        Get Another Prompt
                      </button>
                    </div>
                  </div>
                </div>
              </div>

              <!-- Small Wins Celebration (Gratitude) -->
              <div v-if="currentExercise.id === 'small_wins' && currentSection.key === 'gratitude'">
                <div class="glass-dark rounded-xl" style="padding: var(--card-padding);">
                  <h3 class="font-semibold mb-4" style="color: var(--color-text-dark);">Small Wins Celebration</h3>
                  <p class="mb-6" style="color: var(--color-text-secondary);">A 30-60 second gratitude practice for building confidence and progress</p>

                  <div v-if="!smallWinCompleted" style="display: flex; flex-direction: column; gap: var(--spacing-lg);">
                    <div class="p-4 rounded-lg" style="background: var(--color-bg-accent); border-left: 4px solid var(--color-accent-primary);">
                      <p class="text-sm mb-2" style="color: var(--color-text-secondary);">1. Pause & Reflect: Think about today or yesterday</p>
                      <p class="text-sm mb-2" style="color: var(--color-text-secondary);">2. Recall: One small win - finishing a task, getting up, sending a message, or just breathing</p>
                      <p class="text-sm mb-2" style="color: var(--color-text-secondary);">3. Acknowledge: "That mattered. I did that."</p>
                      <p class="text-sm mb-2" style="color: var(--color-text-secondary);">4. Feel: Place hand on chest, notice warmth, feel thankful</p>
                      <p class="text-sm" style="color: var(--color-text-secondary);">5. Lock it in: Smile gently, whisper "Small steps lead to big changes"</p>
                    </div>

                    <div>
                      <label class="block text-sm font-medium mb-2" style="color: var(--color-text-primary);">My Small Win</label>
                      <textarea v-model="smallWinText"
                                placeholder="What's one small win from today or yesterday? No matter how simple..."
                                class="input-field w-full h-24 resize-none"></textarea>
                    </div>

                    <button @click="celebrateSmallWin" :disabled="!smallWinText.trim()"
                            class="btn-primary w-full"
                            :class="{ 'opacity-50 cursor-not-allowed': !smallWinText.trim() }">
                      üôè Celebrate This Win
                    </button>
                  </div>

                  <div v-else class="text-center py-8">
                    <div class="text-6xl mb-4">‚ú®</div>
                    <p class="text-lg font-semibold mb-2" style="color: var(--color-accent-primary);">Beautiful! That win matters.</p>
                    <p class="mb-4" style="color: var(--color-text-secondary);">Small wins = quiet victories. Be grateful for each one.</p>
                    <div class="p-4 rounded-lg mb-4" style="background: var(--color-bg-accent);">
                      <p style="color: var(--color-text-primary);">{{ smallWinText }}</p>
                    </div>
                    <button @click="resetSmallWin" class="btn-glass">
                      Celebrate Another Win
                    </button>
                  </div>
                </div>
              </div>

              <!-- Basic Acceptance (Acceptance) -->
              <div v-if="currentExercise.id === 'basic_acceptance' && currentSection.key === 'acceptance'">
                <div class="glass-dark rounded-xl" style="padding: var(--card-padding);">
                  <h3 class="font-semibold mb-4" style="color: var(--color-text-dark);">Basic Acceptance</h3>
                  <p class="mb-6" style="color: var(--color-text-secondary);">Acceptance isn't approval ‚Äî it's letting go of extra suffering</p>

                  <div class="text-center py-8">
                    <div class="text-6xl mb-6">üå¨Ô∏è</div>
                    <div class="p-6 rounded-xl mb-6" style="background: var(--color-bg-accent); border: 2px solid var(--color-accent-secondary);">
                      <p class="text-xl font-semibold mb-4" style="color: var(--color-accent-primary);">Take a slow breath</p>
                      <p class="text-lg mb-4" style="color: var(--color-text-dark);">Tell yourself:</p>
                      <p class="text-2xl font-semibold" style="color: var(--color-accent-primary);">"This is the reality right now."</p>
                    </div>

                    <button v-if="!acceptanceBreathComplete" @click="completeAcceptanceBreath" class="btn-primary">
                      ‚úÖ I've Taken This Breath
                    </button>
                    <div v-else class="p-4 rounded-lg" style="background: var(--color-bg-accent);">
                      <p style="color: var(--color-accent-primary); font-weight: 600;">üïäÔ∏è Beautiful. You've let go of the extra suffering.</p>
                    </div>
                  </div>
                </div>
              </div>

              <!-- Cow-dance Acceptance (Acceptance) -->
              <div v-if="currentExercise.id === 'cow_dance_acceptance' && currentSection.key === 'acceptance'">
                <div class="glass-dark rounded-xl" style="padding: var(--card-padding);">
                  <h3 class="font-semibold mb-4" style="color: var(--color-text-dark);">Cow-dance Acceptance üêÑ</h3>
                  <p class="mb-6" style="color: var(--color-text-secondary);">Resisting what you cannot change creates more suffering</p>

                  <div style="display: flex; flex-direction: column; gap: var(--spacing-lg);">
                    <div>
                      <label class="block text-sm font-medium mb-2" style="color: var(--color-text-primary);">What situation are you resisting instead of accepting?</label>
                      <textarea v-model="cowDanceSituation"
                                placeholder="Describe the situation you're struggling to accept..."
                                class="input-field w-full h-24 resize-none"></textarea>
                    </div>

                    <div>
                      <label class="block text-sm font-medium mb-2" style="color: var(--color-text-primary);">What would accepting this situation allow you to feel or do?</label>
                      <textarea v-model="cowDanceAccepting"
                                placeholder="If you accepted this, what would change? What would you feel free to do?"
                                class="input-field w-full h-24 resize-none"></textarea>
                    </div>

                    <button @click="displaySoothingMessage" :disabled="!cowDanceSituation.trim() || !cowDanceAccepting.trim()"
                            class="btn-primary w-full"
                            :class="{ 'opacity-50 cursor-not-allowed': !cowDanceSituation.trim() || !cowDanceAccepting.trim() }">
                      üïäÔ∏è Complete Reflection
                    </button>
                  </div>
                </div>
              </div>

              <!-- Radical Acceptance Exercise 1 (Acceptance) -->
              <div v-if="currentExercise.id === 'radical_acceptance_1' && currentSection.key === 'acceptance'">
                <div class="glass-dark rounded-xl" style="padding: var(--card-padding);">
                  <h3 class="font-semibold mb-4" style="color: var(--color-text-dark);">Radical Acceptance - Exercise 1</h3>
                  <p class="mb-6" style="color: var(--color-text-secondary);">Notice struggle ‚Üí Name reality ‚Üí Drop the fight ‚Üí Breathe ‚Üí Shift toward peace</p>

                  <div style="display: flex; flex-direction: column; gap: var(--spacing-lg);">
                    <div v-if="radicalAcceptanceStep === 1" class="p-4 rounded-lg" style="background: var(--color-bg-accent);">
                      <p class="font-semibold mb-2" style="color: var(--color-accent-primary);">Step 1: Notice the Struggle</p>
                      <p class="text-sm mb-4" style="color: var(--color-text-secondary);">Bring to mind a situation that feels unfair, painful, or out of your control</p>
                      <textarea v-model="radicalSituation"
                                placeholder="What's the situation you're struggling with?"
                                class="input-field w-full h-20 resize-none mb-4"></textarea>
                      <button @click="nextRadicalStep" :disabled="!radicalSituation.trim()" class="btn-primary w-full">Next ‚Üí</button>
                    </div>

                    <div v-if="radicalAcceptanceStep === 2" class="p-4 rounded-lg" style="background: var(--color-bg-accent);">
                      <p class="font-semibold mb-2" style="color: var(--color-accent-primary);">Step 2: Name the Reality</p>
                      <p class="text-lg text-center my-6" style="color: var(--color-text-dark);">Silently say to yourself:<br><strong>"This is what's happening right now."</strong></p>
                      <button @click="nextRadicalStep" class="btn-primary w-full">Next ‚Üí</button>
                    </div>

                    <div v-if="radicalAcceptanceStep === 3" class="p-4 rounded-lg" style="background: var(--color-bg-accent);">
                      <p class="font-semibold mb-2" style="color: var(--color-accent-primary);">Step 3: Drop the Fight</p>
                      <p class="text-lg text-center my-6" style="color: var(--color-text-dark);">Instead of "it shouldn't be this way"<br>Soften into:<br><strong>"I may not like it, but this is the reality I face."</strong></p>
                      <button @click="nextRadicalStep" class="btn-primary w-full">Next ‚Üí</button>
                    </div>

                    <div v-if="radicalAcceptanceStep === 4" class="p-4 rounded-lg" style="background: var(--color-bg-accent);">
                      <p class="font-semibold mb-2" style="color: var(--color-accent-primary);">Step 4: Breathe Into It</p>
                      <p class="text-lg text-center my-6" style="color: var(--color-text-dark);">Take a slow breath<br>Imagine making space around the pain</p>
                      <div class="text-6xl text-center my-6">üå¨Ô∏è</div>
                      <button @click="nextRadicalStep" class="btn-primary w-full">Next ‚Üí</button>
                    </div>

                    <div v-if="radicalAcceptanceStep === 5" class="p-4 rounded-lg" style="background: var(--color-bg-accent);">
                      <p class="font-semibold mb-4" style="color: var(--color-accent-primary);">Step 5: Shift Toward Peace</p>
                      <div class="text-center mb-4">
                        <p class="text-lg mb-2" style="color: var(--color-text-dark);">Accepting doesn't mean approving</p>
                        <p class="text-xl font-semibold" style="color: var(--color-accent-primary);">It means freeing myself from extra suffering</p>
                      </div>
                      <button @click="nextRadicalStep" class="btn-primary w-full">‚úÖ Complete</button>
                    </div>

                    <button v-if="radicalAcceptanceStep === 5" @click="resetRadicalAcceptance" class="btn-glass w-full mt-4">
                      Start Again
                    </button>
                  </div>
                </div>
              </div>

              <!-- Radical Acceptance Exercise 2 (Acceptance) -->
              <div v-if="currentExercise.id === 'radical_acceptance_2' && currentSection.key === 'acceptance'">
                <div class="glass-dark rounded-xl" style="padding: var(--card-padding);">
                  <h3 class="font-semibold mb-4" style="color: var(--color-text-dark);">Radical Acceptance - Reaffirmation</h3>
                  <p class="mb-6" style="color: var(--color-text-secondary);">Settle and breathe ‚Üí Recall struggle ‚Üí Reaffirm benefits ‚Üí Rest in calm</p>

                  <div style="display: flex; flex-direction: column; gap: var(--spacing-lg);">
                    <div class="p-4 rounded-lg" style="background: var(--color-bg-accent);">
                      <p class="font-semibold mb-2" style="color: var(--color-accent-primary);">1. Settle and Breathe</p>
                      <p class="text-sm mb-4" style="color: var(--color-text-secondary);">Sit comfortably, close your eyes, take a few slow breaths</p>
                    </div>

                    <div>
                      <label class="block text-sm font-medium mb-2" style="color: var(--color-text-primary);">2. Recall a Struggle</label>
                      <textarea v-model="radicalExercise2Struggle"
                                placeholder="Think of something recent you've been resisting or holding onto..."
                                class="input-field w-full h-20 resize-none"></textarea>
                    </div>

                    <div class="p-4 rounded-lg" style="background: var(--color-bg-accent);">
                      <p class="font-semibold mb-3" style="color: var(--color-accent-primary);">3. Whisper Acceptance</p>
                      <p class="text-center text-lg mb-4" style="color: var(--color-text-dark);">"I don't have to fight this right now.<br>I can let go."</p>
                    </div>

                    <div class="p-4 rounded-lg" style="background: var(--color-bg-accent);">
                      <p class="font-semibold mb-3" style="color: var(--color-accent-primary);">4. Reaffirm the Benefits</p>
                      <div class="space-y-2">
                        <p class="text-sm" style="color: var(--color-text-secondary);">‚úì Acceptance helps me move forward</p>
                        <p class="text-sm" style="color: var(--color-text-secondary);">‚úì Letting go brings me peace</p>
                        <p class="text-sm" style="color: var(--color-text-secondary);">‚úì When I accept, I feel lighter, calmer, centered</p>
                        <p class="text-sm" style="color: var(--color-text-secondary);">‚úì Letting go of the uncontrollable helps me feel content</p>
                      </div>
                    </div>

                    <div class="p-4 rounded-lg text-center" style="background: var(--color-bg-accent);">
                      <p class="font-semibold mb-2" style="color: var(--color-accent-primary);">5. Rest in Calm</p>
                      <p class="text-sm mb-4" style="color: var(--color-text-secondary);">Place hand on heart, notice the warmth, sit quietly</p>
                      <div class="text-4xl mb-4">üíö</div>
                      <p style="color: var(--color-accent-primary);">A calmer body, a quieter mind</p>
                    </div>

                    <button @click="displaySoothingMessage" :disabled="!radicalExercise2Struggle.trim()"
                            class="btn-primary w-full"
                            :class="{ 'opacity-50 cursor-not-allowed': !radicalExercise2Struggle.trim() }">
                      üïäÔ∏è Complete Practice
                    </button>
                  </div>
                </div>
              </div>

              <!-- Body Scan / PMR (Mindfulness) -->
              <div v-if="currentExercise.id === 'body_scan' && currentSection.key === 'mindfulness'">
                <div class="glass-dark rounded-xl" style="padding: var(--card-padding);">
                  <h3 class="font-semibold mb-4" style="color: var(--color-text-dark);">Body Scan - Progressive Muscle Relaxation (PMR)</h3>

                  <div v-if="!bodyScanComplete" style="display: flex; flex-direction: column; gap: var(--spacing-lg);">
                    <!-- Educational intro -->
                    <div class="p-4 rounded-lg" style="background: var(--color-bg-accent);">
                      <p class="text-sm mb-3" style="color: var(--color-text-secondary);">
                        üí° <strong>Why PMR works:</strong> When we're anxious, our amygdala (threat detection system) keeps us in "threat mode."
                        PMR sends signals to your brain that you're safe, helping you shift from threat to calm.
                      </p>
                      <p class="text-sm" style="color: var(--color-text-secondary);">
                        ‚è∞ <strong>Bedtime tip:</strong> This is especially helpful before sleep to release tension.
                      </p>
                    </div>

                    <!-- Progress indicator -->
                    <div>
                      <div class="flex justify-between text-sm mb-2" style="color: var(--color-text-secondary);">
                        <span>Progress</span>
                        <span>{{ bodyScanStep }}/{{ muscleGroups.length }}</span>
                      </div>
                      <div class="w-full h-2 rounded-full" style="background: var(--color-bg-secondary);">
                        <div class="h-full rounded-full transition-all duration-300"
                             style="background: var(--color-accent-primary);"
                             :style="{ width: (bodyScanStep / muscleGroups.length * 100) + '%' }"></div>
                      </div>
                    </div>

                    <!-- Current muscle group -->
                    <div v-if="bodyScanStep < muscleGroups.length" class="p-6 rounded-lg text-center" style="background: var(--color-bg-accent);">
                      <div class="text-6xl mb-4">üßò</div>
                      <h4 class="font-semibold text-xl mb-4" style="color: var(--color-accent-primary);">
                        {{ muscleGroups[bodyScanStep].name }}
                      </h4>

                      <div class="space-y-4">
                        <div class="p-4 rounded-lg" style="background: rgba(238, 112, 26, 0.1);">
                          <p class="text-sm font-medium mb-2" style="color: var(--color-text-dark);">1. TENSE (5 seconds)</p>
                          <p style="color: var(--color-text-secondary);">{{ muscleGroups[bodyScanStep].tension }}</p>
                        </div>

                        <div class="p-4 rounded-lg" style="background: rgba(110, 193, 228, 0.1);">
                          <p class="text-sm font-medium mb-2" style="color: var(--color-text-dark);">2. RELEASE (10 seconds)</p>
                          <p style="color: var(--color-text-secondary);">{{ muscleGroups[bodyScanStep].release }}</p>
                        </div>
                      </div>

                      <button @click="nextBodyScanStep" class="btn-primary w-full mt-6">
                        {{ bodyScanStep < muscleGroups.length - 1 ? 'Next Muscle Group ‚Üí' : 'Complete Body Scan' }}
                      </button>
                    </div>
                  </div>

                  <!-- Completion state -->
                  <div v-if="bodyScanComplete" class="text-center py-8">
                    <div class="text-6xl mb-4">‚ú®</div>
                    <h4 class="font-semibold text-xl mb-3" style="color: var(--color-accent-primary);">Body Scan Complete!</h4>
                    <p class="mb-6" style="color: var(--color-text-secondary);">
                      You've successfully released tension from all major muscle groups.
                      Notice how your body feels now - calmer, heavier, more grounded.
                    </p>
                    <div class="flex gap-4">
                      <button @click="resetBodyScan" class="btn-glass flex-1">
                        Start Again
                      </button>
                      <button @click="chatWithMandy" class="btn-primary flex-1">
                        üí¨ Chat with Mandy
                      </button>
                    </div>
                  </div>
                </div>
              </div>

              <!-- H-E-A-L Framework (Self-Compassion / Acceptance) -->
              <div v-if="currentExercise.id === 'self_compassion_heal' && currentSection.key === 'acceptance'">
                <div class="glass-dark rounded-xl" style="padding: var(--card-padding);">
                  <h3 class="font-semibold mb-4" style="color: var(--color-text-dark);">Self-Compassion: H-E-A-L Framework</h3>

                  <!-- Educational intro -->
                  <div class="p-4 rounded-lg mb-6" style="background: var(--color-bg-accent);">
                    <p class="text-sm mb-3" style="color: var(--color-text-secondary);">
                      üí° <strong>The Science:</strong> MRI studies show that self-compassion activates the same brain regions as receiving compassion from others.
                      Being kind to yourself literally changes your brain chemistry.
                    </p>
                    <p class="text-sm" style="color: var(--color-text-secondary);">
                      Use H-E-A-L when you're being hard on yourself or caught in negative self-talk.
                    </p>
                  </div>

                  <div style="display: flex; flex-direction: column; gap: var(--spacing-xl);">
                    <!-- Situation -->
                    <div>
                      <label class="block text-sm font-medium mb-2" style="color: var(--color-text-primary);">What's the situation?</label>
                      <textarea v-model="healSituation"
                                placeholder="Describe what happened or what you're struggling with..."
                                class="input-field w-full h-20 resize-none"></textarea>
                    </div>

                    <!-- H - Helpful -->
                    <div class="p-4 rounded-lg" style="background: var(--color-bg-accent);">
                      <div class="flex items-center gap-2 mb-3">
                        <div class="w-8 h-8 rounded-full flex items-center justify-center font-bold" style="background: var(--color-accent-primary); color: white;">H</div>
                        <h4 class="font-semibold" style="color: var(--color-accent-primary);">Is this thought HELPFUL?</h4>
                      </div>
                      <p class="text-sm mb-3" style="color: var(--color-text-secondary);">Is beating yourself up helping you move forward, or keeping you stuck?</p>
                      <textarea v-model="healHelpful"
                                placeholder="Write about whether this self-criticism is actually helpful..."
                                class="input-field w-full h-16 resize-none"></textarea>
                    </div>

                    <!-- E - Evidence -->
                    <div class="p-4 rounded-lg" style="background: var(--color-bg-accent);">
                      <div class="flex items-center gap-2 mb-3">
                        <div class="w-8 h-8 rounded-full flex items-center justify-center font-bold" style="background: var(--color-accent-primary); color: white;">E</div>
                        <h4 class="font-semibold" style="color: var(--color-accent-primary);">What's the EVIDENCE?</h4>
                      </div>
                      <p class="text-sm mb-3" style="color: var(--color-text-secondary);">Look for facts, not feelings. What proof do you have that contradicts your harsh self-judgment?</p>
                      <textarea v-model="healEvidence"
                                placeholder="List times you've succeeded, or evidence against this negative belief..."
                                class="input-field w-full h-20 resize-none"></textarea>
                    </div>

                    <!-- A - Alternative -->
                    <div class="p-4 rounded-lg" style="background: var(--color-bg-accent);">
                      <div class="flex items-center gap-2 mb-3">
                        <div class="w-8 h-8 rounded-full flex items-center justify-center font-bold" style="background: var(--color-accent-primary); color: white;">A</div>
                        <h4 class="font-semibold" style="color: var(--color-accent-primary);">What's an ALTERNATIVE perspective?</h4>
                      </div>
                      <p class="text-sm mb-3" style="color: var(--color-text-secondary);">Reframe with kindness. What would you say to a friend in this situation?</p>
                      <textarea v-model="healAlternative"
                                placeholder="Write a kinder, more balanced perspective..."
                                class="input-field w-full h-20 resize-none"></textarea>
                    </div>

                    <!-- L - Loved One -->
                    <div class="p-4 rounded-lg" style="background: var(--color-bg-accent);">
                      <div class="flex items-center gap-2 mb-3">
                        <div class="w-8 h-8 rounded-full flex items-center justify-center font-bold" style="background: var(--color-accent-primary); color: white;">L</div>
                        <h4 class="font-semibold" style="color: var(--color-accent-primary);">What would a LOVED ONE say?</h4>
                      </div>
                      <p class="text-sm mb-3" style="color: var(--color-text-secondary);">Think of someone who cares about you. What compassionate words would they offer?</p>
                      <textarea v-model="healLovedOne"
                                placeholder="Imagine their kind, supportive words..."
                                class="input-field w-full h-20 resize-none"></textarea>
                    </div>

                    <!-- Completion -->
                    <div v-if="healSituation.trim() && healAlternative.trim()" class="p-4 rounded-lg text-center" style="background: rgba(110, 193, 228, 0.1);">
                      <div class="text-4xl mb-3">üíö</div>
                      <p class="font-semibold mb-2" style="color: var(--color-accent-primary);">Self-Compassion Practice</p>
                      <p class="text-sm" style="color: var(--color-text-secondary);">
                        Place your hand on your heart. Take a slow breath. You deserve the same kindness you'd give others.
                      </p>
                    </div>

                    <button @click="completeHealExercise" :disabled="!healSituation.trim() || !healAlternative.trim()"
                            class="btn-primary w-full"
                            :class="{ 'opacity-50 cursor-not-allowed': !healSituation.trim() || !healAlternative.trim() }">
                      ‚úÖ Complete H-E-A-L Practice
                    </button>
                  </div>
                </div>
              </div>

              <!-- Fun & Playfulness Diary (Nurturing) -->
              <div v-if="currentExercise.id === 'fun_diary' && currentSection.key === 'nurturing'">
                <div class="glass-dark rounded-xl" style="padding: var(--card-padding);">
                  <h3 class="font-semibold mb-4" style="color: var(--color-text-dark);">Fun & Playfulness Diary</h3>
                  <p class="mb-6" style="color: var(--color-text-secondary);">Track moments of joy, play, and lightness in your day</p>

                  <div style="display: flex; flex-direction: column; gap: var(--spacing-xl);">
                    <!-- Today I had fun when... -->
                    <div>
                      <label class="block text-sm font-medium mb-2" style="color: var(--color-text-primary);">Today I had fun when...</label>
                      <textarea v-model="funDiaryActivity"
                                placeholder="What made you smile or laugh today?"
                                class="input-field w-full h-20 resize-none"></textarea>
                    </div>

                    <!-- Something playful I tried... -->
                    <div>
                      <label class="block text-sm font-medium mb-2" style="color: var(--color-text-primary);">Something playful I tried...</label>
                      <textarea v-model="funDiaryPlayful"
                                placeholder="Did you try something silly, spontaneous, or lighthearted?"
                                class="input-field w-full h-20 resize-none"></textarea>
                    </div>

                    <!-- Emoji feeling picker -->
                    <div>
                      <label class="block text-sm font-medium mb-2" style="color: var(--color-text-primary);">How did it feel?</label>
                      <div class="flex flex-wrap gap-3">
                        <button v-for="emoji in ['üòä', 'üòÑ', 'üòÅ', 'ü•∞', 'üòå', 'ü§ó', 'üòÇ', 'ü•≥', 'üòé', 'ü§©']"
                                :key="emoji"
                                @click="funDiaryFeeling = emoji"
                                class="text-3xl p-3 rounded-lg transition-all"
                                :style="{
                                  background: funDiaryFeeling === emoji ? 'var(--color-accent-primary)' : 'var(--color-bg-secondary)',
                                  transform: funDiaryFeeling === emoji ? 'scale(1.2)' : 'scale(1)'
                                }">
                          {{ emoji }}
                        </button>
                      </div>
                    </div>

                    <!-- 8 Playfulness Ideas -->
                    <div class="p-4 rounded-lg" style="background: var(--color-bg-accent);">
                      <h4 class="font-semibold mb-3" style="color: var(--color-accent-primary);">üí° Playfulness Ideas</h4>
                      <div class="grid grid-cols-2 gap-2 text-sm" style="color: var(--color-text-secondary);">
                        <div>‚Ä¢ Make silly faces in mirror</div>
                        <div>‚Ä¢ Dance to your favorite song</div>
                        <div>‚Ä¢ Tell a terrible joke</div>
                        <div>‚Ä¢ Wear something fun</div>
                        <div>‚Ä¢ Play with a pet</div>
                        <div>‚Ä¢ Sing loudly</div>
                        <div>‚Ä¢ Skip instead of walk</div>
                        <div>‚Ä¢ Doodle something random</div>
                      </div>
                    </div>

                    <!-- 8 Calming Playful Prompts -->
                    <div class="p-4 rounded-lg" style="background: var(--color-bg-accent);">
                      <h4 class="font-semibold mb-3" style="color: var(--color-accent-primary);">üïØÔ∏è Calming Playful Prompts</h4>
                      <div class="grid grid-cols-2 gap-2 text-sm" style="color: var(--color-text-secondary);">
                        <div>‚Ä¢ Light a scented candle</div>
                        <div>‚Ä¢ Sway gently to music</div>
                        <div>‚Ä¢ Make up silly rhymes</div>
                        <div>‚Ä¢ Blow bubbles slowly</div>
                        <div>‚Ä¢ Color in a coloring book</div>
                        <div>‚Ä¢ Play with play-dough</div>
                        <div>‚Ä¢ Hum a gentle tune</div>
                        <div>‚Ä¢ Arrange flowers/objects</div>
                      </div>
                    </div>

                    <button @click="saveFunDiary" :disabled="!funDiaryActivity.trim()"
                            class="btn-primary w-full"
                            :class="{ 'opacity-50 cursor-not-allowed': !funDiaryActivity.trim() }">
                      {{ funDiaryFeeling }} Save Fun Diary Entry
                    </button>
                  </div>
                </div>
              </div>

              <!-- Inner Child Work (Nurturing) -->
              <div v-if="currentExercise.id === 'inner_child_work' && currentSection.key === 'nurturing'">
                <div class="glass-dark rounded-xl" style="padding: var(--card-padding);">
                  <h3 class="font-semibold mb-4" style="color: var(--color-text-dark);">Inner Child Play</h3>
                  <p class="mb-6" style="color: var(--color-text-secondary);">Reconnect with the playful, spontaneous part of yourself</p>

                  <div style="display: flex; flex-direction: column; gap: var(--spacing-xl);">
                    <!-- Intro -->
                    <div class="p-4 rounded-lg" style="background: var(--color-bg-accent);">
                      <p class="text-sm mb-2" style="color: var(--color-text-secondary);">
                        <strong>Pause & Remember:</strong> Think back to when you were a child. What made you feel free, joyful, and fully yourself?
                      </p>
                      <p class="text-sm" style="color: var(--color-text-secondary);">
                        <strong>Give yourself 5 minutes</strong> to try one of these playful activities:
                      </p>
                    </div>

                    <!-- 10 Inner Child Prompts -->
                    <div>
                      <h4 class="font-semibold mb-3" style="color: var(--color-accent-primary);">Choose a Playful Activity:</h4>
                      <div class="grid grid-cols-1 gap-2">
                        <button v-for="(prompt, index) in innerChildPrompts"
                                :key="index"
                                @click="selectedInnerChildPrompt = prompt"
                                class="text-left p-3 rounded-lg transition-all"
                                :style="{
                                  background: selectedInnerChildPrompt === prompt ? 'var(--color-accent-primary)' : 'var(--color-bg-secondary)',
                                  color: selectedInnerChildPrompt === prompt ? 'white' : 'var(--color-text-primary)'
                                }">
                          {{ prompt }}
                        </button>
                      </div>
                    </div>

                    <!-- Selected prompt display -->
                    <div v-if="selectedInnerChildPrompt" class="p-4 rounded-lg text-center" style="background: rgba(238, 112, 26, 0.1);">
                      <div class="text-6xl mb-3">üß∏</div>
                      <p class="font-semibold text-lg mb-2" style="color: var(--color-accent-primary);">
                        {{ selectedInnerChildPrompt }}
                      </p>
                      <p class="text-sm" style="color: var(--color-text-secondary);">
                        Take 5 minutes to play! Set a timer and give yourself full permission.
                      </p>
                    </div>

                    <!-- Reflection: How did I feel? -->
                    <div v-if="selectedInnerChildPrompt">
                      <label class="block text-sm font-medium mb-2" style="color: var(--color-text-primary);">How did I feel?</label>
                      <div class="flex flex-wrap gap-3 mb-4">
                        <button v-for="feeling in ['üòä Joyful', 'üòå Peaceful', 'üòÑ Silly', 'ü•∞ Free', 'üòÇ Giggly', 'ü§ó Warm', 'üòé Cool', 'ü•≥ Energized']"
                                :key="feeling"
                                @click="innerChildFeeling = feeling"
                                class="px-4 py-2 rounded-lg text-sm transition-all"
                                :style="{
                                  background: innerChildFeeling === feeling ? 'var(--color-accent-primary)' : 'var(--color-bg-secondary)',
                                  color: innerChildFeeling === feeling ? 'white' : 'var(--color-text-primary)'
                                }">
                          {{ feeling }}
                        </button>
                      </div>

                      <textarea v-model="innerChildReflection"
                                placeholder="What did this experience teach me? What surprised me?"
                                class="input-field w-full h-24 resize-none"></textarea>
                    </div>

                    <!-- Completion message -->
                    <div v-if="innerChildReflection.trim()" class="p-4 rounded-lg text-center" style="background: rgba(110, 193, 228, 0.1);">
                      <div class="text-4xl mb-3">üí´</div>
                      <p class="text-sm" style="color: var(--color-text-secondary);">
                        <strong>Connecting with your inner child reminds you that...</strong><br>
                        Play isn't frivolous‚Äîit's healing. Joy isn't earned‚Äîit's your birthright. You deserve to feel light and free.
                      </p>
                    </div>

                    <button @click="completeInnerChildWork" :disabled="!selectedInnerChildPrompt || !innerChildReflection.trim()"
                            class="btn-primary w-full"
                            :class="{ 'opacity-50 cursor-not-allowed': !selectedInnerChildPrompt || !innerChildReflection.trim() }">
                      üß∏ Complete Inner Child Work
                    </button>
                  </div>
                </div>
              </div>

              <!-- Default exercise placeholder for other exercises -->
              <div v-if="!isSpecialExercise(currentExercise.id)">
                <div class="glass-dark rounded-xl" style="padding: var(--card-padding);">
                  <h3 class="font-semibold text-white mb-4">{{ currentExercise.name }}</h3>
                  <p class="text-stone-300 mb-6">{{ currentExercise.description }}</p>
                  <div class="text-center py-8">
                    <div class="text-6xl mb-4">üöß</div>
                    <p class="text-stone-400">Interactive exercise coming soon!</p>
                    <p class="text-sm text-stone-500 mt-2">This exercise will be fully interactive in a future update.</p>
                  </div>
                </div>
              </div>

              <button @click="chatWithMandy" class="btn-primary w-full">
                üí¨ Discuss This with AI Mandy
              </button>
            </div>
          </div>

        </div>
        <!-- Crisis Resources Footer -->
        <div v-if="currentView !== 'chat'" class="mt-16 pt-8 border-t border-stone-700">
          <div class="text-center max-w-4xl mx-auto">
            <h3 class="text-lg font-semibold text-red-400 mb-4">üö® Need Immediate Help?</h3>
            <div class="grid grid-cols-1 md:grid-cols-4 gap-4 text-sm">
              <div class="bg-amber-500/10 border border-amber-400/30 rounded-xl p-4">
                <div class="font-semibold text-amber-300">Contact Mandy</div>
                <div class="text-stone-300 mt-2">
                  <a href="https://thoughtsonlifeandlove.com/contact-the-team/" target="_blank" class="text-amber-200 hover:text-amber-100 underline block">üìû Professional Therapy</a>
                  <div class="text-xs text-stone-400 mt-1">Real therapist support</div>
                </div>
              </div>
              <div class="bg-red-500/10 border border-red-400/30 rounded-xl p-4">
                <div class="font-semibold text-red-300">Crisis Support</div>
                <div class="text-stone-300 mt-2">
                  <div>üá∫üá∏ 988 Suicide & Crisis Lifeline</div>
                  <div>üá¨üáß 116 123 Samaritans</div>
                  <div>üá¶üá∫ 13 11 14 Lifeline Australia</div>
                </div>
              </div>
              <div class="bg-blue-500/10 border border-blue-400/30 rounded-xl p-4">
                <div class="font-semibold text-blue-300">Text Support</div>
                <div class="text-stone-300 mt-2">
                  <div>üá∫üá∏ Text HOME to 741741</div>
                  <div>üá¨üáß Text SHOUT to 85258</div>
                  <div>üá®üá¶ Text TALK to 686868</div>
                </div>
              </div>
              <div class="bg-purple-500/10 border border-purple-400/30 rounded-xl p-4">
                <div class="font-semibold text-purple-300">Emergency</div>
                <div class="text-stone-300 mt-2">
                  <div>üöë Call 911 (US)</div>
                  <div>üöë Call 999 (UK)</div>
                  <div>üöë Call 000 (AU)</div>
                </div>
              </div>
            </div>
            <p class="text-xs text-stone-400 mt-4">
              Cowch provides wellness coaching support, not crisis intervention or medical treatment. 
              If you're in crisis, please reach out to qualified professionals immediately.
            </p>
          </div>
        </div>
      </main>

      <!-- Bottom Navigation -->
      <nav class="fixed bottom-0 left-0 right-0 z-50 glass-dark border-t" style="border-color: rgba(84, 89, 95, 0.15); backdrop-filter: blur(20px);">
        <div class="max-w-4xl mx-auto px-4 py-3">
          <div class="flex justify-around items-center">
            <button @click="goHome" class="flex flex-col items-center space-y-1 p-3 rounded-lg transition-all duration-200 relative group"
                    :class="currentView === 'home' ? 'shadow-sm' : ''"
                    :style="currentView === 'home' ? 'color: var(--color-accent-primary); background: var(--color-bg-accent);' : 'color: var(--color-text-secondary);'">
              <div class="relative">
                <svg class="w-6 h-6 transition-transform group-hover:scale-110" fill="currentColor" viewBox="0 0 24 24">
                  <path d="M10 20v-6h4v6h5v-8h3L12 3 2 12h3v8z"/>
                </svg>
                <div v-if="currentView === 'home'" class="absolute -top-1 -right-1 w-2 h-2 rounded-full pulse-glow" style="background: var(--color-accent-primary);"></div>
              </div>
              <span class="text-xs font-medium">üè† Home</span>
            </button>

            <button @click="chatWithMandy" class="flex flex-col items-center space-y-1 p-3 rounded-lg transition-all duration-200 relative group"
                    :class="currentView === 'chat' ? 'shadow-sm' : ''"
                    :style="currentView === 'chat' ? 'color: var(--color-accent-primary); background: var(--color-bg-accent);' : 'color: var(--color-text-secondary);'">
              <div class="relative">
                <svg class="w-6 h-6 transition-transform group-hover:scale-110" fill="currentColor" viewBox="0 0 24 24">
                  <path d="M20 2H4c-1.1 0-2 .9-2 2v12c0 1.1.9 2 2 2h4l4 4 4-4h4c1.1 0 2-.9 2-2V4c0-1.1-.9-2-2-2z"/>
                </svg>
                <div v-if="currentView === 'chat'" class="absolute -top-1 -right-1 w-2 h-2 rounded-full pulse-glow" style="background: var(--color-accent-primary);"></div>
              </div>
              <span class="text-xs font-medium">üí¨ Chat</span>
            </button>

            <button @click="exploreImagine" class="flex flex-col items-center space-y-1 p-3 rounded-lg transition-all duration-200 relative group"
                    :class="currentView === 'imagine' ? 'shadow-sm' : ''"
                    :style="currentView === 'imagine' ? 'color: var(--color-accent-primary); background: var(--color-bg-accent);' : 'color: var(--color-text-secondary);'">
              <div class="relative">
                <svg class="w-6 h-6 transition-transform group-hover:scale-110" fill="currentColor" viewBox="0 0 24 24">
                  <path d="M12 2l3.09 6.26L22 9.27l-5 4.87 1.18 6.88L12 17.77l-6.18 3.25L7 14.14 2 9.27l6.91-1.01L12 2z"/>
                </svg>
                <div v-if="currentView === 'imagine'" class="absolute -top-1 -right-1 w-2 h-2 rounded-full pulse-glow" style="background: var(--color-accent-primary);"></div>
              </div>
              <span class="text-xs font-medium">üß† IMAGINE</span>
            </button>

            <button @click="showMoodTracker" class="flex flex-col items-center space-y-1 p-3 rounded-lg transition-all duration-200 relative group"
                    :class="currentView === 'mood' ? 'shadow-sm' : ''"
                    :style="currentView === 'mood' ? 'color: var(--color-accent-primary); background: var(--color-bg-accent);' : 'color: var(--color-text-secondary);'">
              <div class="relative">
                <svg class="w-6 h-6 transition-transform group-hover:scale-110" fill="currentColor" viewBox="0 0 24 24">
                  <path d="M9 11H7v8h2v-8zm4-4h-2v12h2V7zm4-4h-2v16h2V3z"/>
                </svg>
                <div v-if="currentView === 'mood'" class="absolute -top-1 -right-1 w-2 h-2 rounded-full pulse-glow" style="background: var(--color-accent-primary);"></div>
              </div>
              <span class="text-xs font-medium">üìà Moo-gress</span>
            </button>
          </div>
        </div>
      </nav>
    </div>
  </div>

  <script>
    const { createApp, ref, computed } = Vue;
    
    createApp({
      setup() {
        const currentView = ref('home');
        const currentSection = ref(null);
        const currentExercise = ref(null);
        const newMessage = ref('');
        const isTyping = ref(false);
        const selectedMood = ref(null);
        const moodNote = ref('');

        // Exercise-specific reactive variables
        const currentGroundingStep = ref(0);
        const groundingCheckedItems = ref({});
        const breathingActive = ref(false);
        const breathingPhase = ref('inhale');
        const breathingCount = ref(4);
        const breathingDuration = ref(4000);
        const currentBreathRound = ref(1);
        const totalBreathRounds = ref(4);
        const energyGivers = ref(['Morning coffee', 'Time in nature', 'Good conversations']);
        const energyDrains = ref(['Endless emails', 'Traffic jams', 'Negative news']);
        const newEnergyGiver = ref('');
        const newEnergyDrain = ref('');
        const threeGoodThings = ref([
          { what: '', why: '' },
          { what: '', why: '' },
          { what: '', why: '' }
        ]);
        
        // Moove with Mandy quotes from her real blog
        const currentQuote = ref(null);
        const blogQuotes = ref([]);
        const isLoadingQuote = ref(false);
        
        // Authentic Mandy quotes (from her actual work)
        const authenticQuotes = ref([
          {
            text: "Whether you just need someone to listen to you or want to make udderly amazing changes, counselling can be the pivotal turning point where good things start to happen",
            author: "Mandy Kloppers"
          },
          {
            text: "This is the start of your new life...",
            author: "Mandy Kloppers"
          },
          {
            text: "You'll be amazed at what you can achieve when you put your mind to it",
            author: "Mandy Kloppers"
          },
          {
            text: "Even the darkest night will end and the sun will rise",
            author: "Mandy Kloppers"
          },
          {
            text: "We will work as a team",
            author: "Mandy Kloppers"
          },
          {
            text: "Help you understand why things are going wrong",
            author: "Mandy Kloppers"
          },
          {
            text: "Mental health is not a destination, but a process. It's about how you drive, not where you're going",
            author: "Mandy Kloppers"
          },
          {
            text: "Your mental health is a priority. Your happiness is essential. Your self-care is a necessity",
            author: "Mandy Kloppers"
          }
        ]);

        // Soothing One-Liners for completion popups
        const soothingMessages = ref([
          "Every small step counts ‚Äî take a moment to thank yourself for it.",
          "Celebrate the little wins; they're the building blocks of big change.",
          "Gratitude grows when you notice the small things you've achieved today.",
          "Even the tiniest progress is proof you're moving forward.",
          "Pause, smile, and give thanks for what you managed today ‚Äî it matters.",
          "Small wins = quiet victories. Be grateful for each one."
        ]);

        const showSoothingPopup = ref(false);
        const currentSoothingMessage = ref('');

        const displaySoothingMessage = () => {
          const randomIndex = Math.floor(Math.random() * soothingMessages.value.length);
          currentSoothingMessage.value = soothingMessages.value[randomIndex];
          showSoothingPopup.value = true;

          // Auto-hide after 5 seconds
          setTimeout(() => {
            showSoothingPopup.value = false;
          }, 5000);
        };

        // New exercise variables
        // Thought Unhooking (Acceptance)
        const currentBotherThought = ref('');
        const selectedThoughtLabel = ref('');
        const thoughtLabels = ref(['Worry', 'Fear', 'Judgment', 'Catastrophe', 'Rumination', 'Self-Doubt']);
        const actionableReframe = ref('');

        // Wellness Check-In (Self-Care)
        const wellnessMood = ref(5);
        const wellnessExercise = ref(5);
        const wellnessDiet = ref(5);
        const wellnessAppearance = ref(5);
        const wellnessImprovements = ref('');

        // Fun Prompt Generator (Nurturing)
        const funPrompts = ref([
          "Do a silly dance for 30 seconds",
          "Tell yourself the worst (cheesiest) joke you can think of",
          "Put a random object on your head and see how long it balances",
          "Hum your favorite song out loud like nobody's listening",
          "Try speaking in a silly accent for a minute",
          "Draw a doodle with your non-dominant hand",
          "Pretend you're a kid again ‚Äî skip, hop, or spin in a circle",
          "Find one tiny thing that makes you smile right now"
        ]);
        const currentFunPrompt = ref('');
        const funPromptDone = ref(false);
        const funPromptFeeling = ref('');

        // Gratitude Small Wins (Gratitude)
        const smallWinText = ref('');
        const smallWinCompleted = ref(false);

        // Basic Acceptance (Acceptance)
        const acceptanceBreathComplete = ref(false);

        // Cow-dance Acceptance (Acceptance)
        const cowDanceSituation = ref('');
        const cowDanceAccepting = ref('');

        // Radical Acceptance Exercises (Acceptance)
        const radicalSituation = ref('');
        const radicalAcceptanceStep = ref(1);
        const radicalExercise2Struggle = ref('');

        // Body Scan / PMR (Mindfulness)
        const bodyScanStep = ref(0);
        const bodyScanComplete = ref(false);
        const muscleGroups = ref([
          { name: "Hands & Forearms", tension: "Make fists and hold tight", release: "Release and let your hands rest open" },
          { name: "Upper Arms", tension: "Bend your arms and tense your biceps", release: "Let your arms drop and relax" },
          { name: "Shoulders", tension: "Raise your shoulders to your ears", release: "Let them drop and feel the tension melt" },
          { name: "Face & Jaw", tension: "Scrunch your face and clench your jaw", release: "Let everything soften and relax" },
          { name: "Chest & Back", tension: "Take a deep breath and hold", release: "Exhale slowly and let your back sink down" },
          { name: "Stomach", tension: "Tighten your stomach muscles", release: "Let your belly be soft and relaxed" },
          { name: "Hips & Buttocks", tension: "Squeeze your buttocks together", release: "Let go completely and feel grounded" },
          { name: "Thighs", tension: "Tense your thigh muscles", release: "Let your legs feel heavy and relaxed" },
          { name: "Calves", tension: "Point your toes and flex your calves", release: "Release and let your legs be still" },
          { name: "Feet", tension: "Curl your toes tightly", release: "Relax your feet completely" }
        ]);

        // H-E-A-L Framework (Acceptance/Self-Compassion)
        const healSituation = ref('');
        const healHelpful = ref('');
        const healEvidence = ref('');
        const healAlternative = ref('');
        const healLovedOne = ref('');

        // Fun & Playfulness Diary (Nurturing)
        const funDiaryDate = ref('');
        const funDiaryActivity = ref('');
        const funDiaryPlayful = ref('');
        const funDiaryFeeling = ref('üòä');

        // Inner Child Work (Nurturing)
        const innerChildPrompts = ref([
          "üñçÔ∏è Doodle or color something silly",
          "ü´ß Blow bubbles (real or pretend)",
          "üéµ Sing your favorite childhood song",
          "üè† Build a blanket fort",
          "ü§∏ Do a cartwheel or somersault (safely!)",
          "üç¨ Eat your favorite childhood snack",
          "üéÆ Play a game you loved as a kid",
          "üå≥ Climb a tree or swing on a swing",
          "üìñ Read a children's book",
          "üé® Finger paint or play with play-dough"
        ]);
        const selectedInnerChildPrompt = ref('');
        const innerChildReflection = ref('');
        const innerChildFeeling = ref('');

        // Values Compass (Exploring)
        const selectedValues = ref([]);
        const valueReflections = ref({});
        const availableValues = ref([
          'Family', 'Freedom', 'Creativity', 'Adventure', 'Security', 'Growth',
          'Connection', 'Achievement', 'Health', 'Authenticity', 'Fun', 'Peace',
          'Learning', 'Service', 'Independence', 'Tradition', 'Beauty', 'Spirituality',
          'Success', 'Nature', 'Justice', 'Compassion', 'Integrity', 'Innovation'
        ]);

        // Connection Web (Interactions)
        const innerCircle = ref(['Best Friend', 'Family Member']);
        const widerNetwork = ref(['Colleague', 'Neighbor']);
        const newInnerPerson = ref('');
        const newWiderPerson = ref('');
        const connectionActions = ref([]);

        // Joy Jar (Nurturing)
        const joyEntries = ref([]);
        const currentJoyEntry = ref({
          type: '',
          when: 'today',
          level: 0,
          description: ''
        });
        
        const moodOptions = ref([
          { value: 1, emoji: 'üêÑüò¢', label: 'Udderly Down' },
          { value: 2, emoji: 'üêÑüòî', label: 'Feeling Blue-tiful' },
          { value: 3, emoji: 'üêÑüòê', label: 'Pasture Neutral' },
          { value: 4, emoji: 'üêÑüôÇ', label: 'Moo-ving Along' },
          { value: 5, emoji: 'üêÑüòä', label: 'Udderly Amazing' }
        ]);
        
        const imagineSections = ref([
          {
            key: 'self_care',
            title: 'I - Me, Myself & I',
            subtitle: 'Self-care and wellness on your cowch',
            emoji: 'üíé',
            gradient: 'linear-gradient(135deg, #d4a574 0%, #8b6914 100%)', // warm_earth_tones
            shadowColor: 'rgba(212, 165, 116, 0.4)'
          },
          {
            key: 'mindfulness',
            title: 'M - Mindfulness',
            subtitle: 'Mini vaca-tions for your mind',
            emoji: 'üßò‚Äç‚ôÄÔ∏è',
            gradient: 'linear-gradient(135deg, #fb7185 0%, #f97316 100%)', // coral_pinks
            shadowColor: 'rgba(79, 172, 254, 0.4)'
          },
          {
            key: 'acceptance',
            title: 'A - Acceptance',
            subtitle: 'Embracing your current state',
            emoji: 'ü§≤',
            gradient: 'linear-gradient(135deg, #fed7aa 0%, #fb923c 100%)', // warm_peach
            shadowColor: 'rgba(168, 237, 234, 0.4)'
          },
          {
            key: 'gratitude',
            title: 'G - Gratitude',
            subtitle: 'Focusing on positive aspects',
            emoji: '‚ú®',
            gradient: 'linear-gradient(135deg, #fbbf24 0%, #EE701A 100%)', // golden_coral
            shadowColor: 'rgba(254, 225, 64, 0.4)'
          },
          {
            key: 'interactions',
            title: 'I - Interactions',
            subtitle: 'Connecting with others beyond the cowch',
            emoji: 'ü§ù',
            gradient: 'linear-gradient(135deg, #f472b6 0%, #fb7185 100%)', // soft_coral_pinks
            shadowColor: 'rgba(168, 85, 247, 0.4)'
          },
          {
            key: 'nurturing',
            title: 'N - Nurturing',
            subtitle: 'Fun, playfulness & joy on your cowch',
            emoji: 'üé≠',
            gradient: 'linear-gradient(135deg, #fdba74 0%, #f59e0b 100%)', // warm_amber
            shadowColor: 'rgba(52, 211, 153, 0.4)'
          },
          {
            key: 'exploring',
            title: 'E - Exploring',
            subtitle: 'Understanding thoughts & behaviors',
            emoji: 'üß†',
            gradient: 'linear-gradient(135deg, #fcd34d 0%, #f97316 100%)', // sunny_orange
            shadowColor: 'rgba(16, 185, 129, 0.4)'
          }
        ]);

        const groundingSteps = ref([
          {
            number: 5,
            title: "5 things you can see",
            description: "Look around and name 5 things you can see",
            items: ["Wall color", "A book", "Your hands", "Light source", "Something small"]
          },
          {
            number: 4,
            title: "4 things you can touch",
            description: "Notice 4 things you can physically feel",
            items: ["Fabric texture", "Temperature", "Surface texture", "Your feet on ground"]
          },
          {
            number: 3,
            title: "3 things you can hear",
            description: "Listen carefully for 3 sounds around you",
            items: ["Background noise", "Your breathing", "Distant sounds"]
          },
          {
            number: 2,
            title: "2 things you can smell",
            description: "Take a moment to notice 2 scents",
            items: ["Air freshener/perfume", "Natural scents"]
          },
          {
            number: 1,
            title: "1 thing you can taste",
            description: "Notice any taste in your mouth",
            items: ["Lingering taste"]
          }
        ]);

        const chatHistory = ref([
          {
            id: 1,
            sender: 'ai_mandy',
            text: "Come to the cowch and get comfy! üêÑ I'm AI Mandy, your wellness coach, and I'm absolutely delighted you've decided to settle in on this special therapeutic cowch for a proper vaca-tion for your mind. This cozy cow-couch is your safe space for encouragement and pattern-matching insights - no bull, just genuine support and evidence-based wellness techniques. So lie back, relax on the cowch, and let's have a supportive chat about building healthy habits together. What's on your mind today?",
            timestamp: new Date()
          }
        ]);

        const chatWithMandy = () => {
          currentView.value = 'chat';
        };

        const exploreImagine = () => {
          currentView.value = 'imagine';
        };

        const showMoodTracker = () => {
          currentView.value = 'mood';
        };

        const goHome = () => {
          currentView.value = 'home';
        };

        const goToSection = (sectionKey) => {
          const section = imagineSections.value.find(s => s.key === sectionKey);
          if (section) {
            currentSection.value = section;
            currentView.value = 'section';
          }
        };

        const getSectionGuidance = (sectionKey) => {
          const guidance = {
            self_care: "Your relationship with yourself sets the foundation for everything else. What would loving yourself look like today?",
            mindfulness: "This moment is the only one where change can happen. What do you notice right now, without judgment?",
            acceptance: "Fighting what is only creates more suffering. What would accepting this situation allow you to do?",
            gratitude: "Gratitude shifts perspective from lack to abundance. What's working in your life right now?",
            interactions: "Connection is essential for wellbeing. How might you nurture your relationships today?",
            nurturing: "Joy and playfulness are not luxuries‚Äîthey're necessities. What brings lightness to your heart?",
            exploring: "Understanding your patterns is the first step to change. What thoughts or behaviors are you curious about?"
          };
          return guidance[sectionKey] || "Welcome to this section of your wellness pasture.";
        };

        const getSectionTools = (sectionKey) => {
          const tools = {
            self_care: [
              { id: "wellness_checkin", name: "Wellness Check-In", description: "Rate mood, exercise, diet, appearance with improvement prompts", icon: "üåü" },
              { id: "boundary_setting", name: "Boundary Setting", description: "Practice saying no with kindness", icon: "üõ°Ô∏è" },
              { id: "energy_audit", name: "Energy Audit", description: "List positives and negatives, find balance", icon: "‚ö°" }
            ],
            mindfulness: [
              { id: "grounding_5432", name: "Sense-ational Vaca-tion", description: "Mini mental getaway", icon: "üåø" },
              { id: "breathing_4_7_8", name: "Vaca-tion Breathing", description: "Mini mental getaway", icon: "ü´Å" },
              { id: "body_scan", name: "Body Scan", description: "Check in with physical sensations", icon: "üßò" }
            ],
            acceptance: [
              { id: "basic_acceptance", name: "Basic Acceptance", description: "This is reality right now - breathe and let go", icon: "üå¨Ô∏è" },
              { id: "cow_dance_acceptance", name: "Cow-dance Acceptance", description: "What would accepting allow you to feel/do?", icon: "üêÑ" },
              { id: "thought_unhooking", name: "Thought Unhooking", description: "Detach from anxious thoughts - 6000 thoughts a day!", icon: "üé¨" },
              { id: "self_compassion_heal", name: "Self-Compassion (H-E-A-L)", description: "4-step self-kindness practice: Helpful, Evidence, Alternative, Loved one", icon: "üíö" },
              { id: "radical_acceptance_1", name: "Radical Acceptance (Exercise 1)", description: "Notice struggle ‚Üí Name reality ‚Üí Drop fight", icon: "üïäÔ∏è" },
              { id: "radical_acceptance_2", name: "Radical Acceptance (Exercise 2)", description: "Settle & breathe ‚Üí Reaffirm benefits", icon: "ü§≤" }
            ],
            gratitude: [
              { id: "small_wins", name: "Small Wins Celebration", description: "30-60 second gratitude practice", icon: "üèÜ" },
              { id: "three_good_things", name: "Three Good Things", description: "Daily appreciation practice", icon: "‚ú®" },
              { id: "gratitude_letter", name: "Gratitude Letter", description: "Write to someone who helped you", icon: "üíå" }
            ],
            interactions: [
              { id: "connection_web", name: "Connection Web", description: "Interactive concentric circles - drag & drop connections", icon: "üï∏Ô∏è" },
              { id: "connection_exercises", name: "Daily Connection Exercises", description: "Check-ins, listening, gratitude, kindness", icon: "üí¨" },
              { id: "social_anxiety_tools", name: "Social Anxiety Exercises", description: "Comfort zone ladder & reframing", icon: "üå±" },
              { id: "one_week_program", name: "1-Week Connection Program", description: "Structured 7-day interaction practice", icon: "üìÖ" },
              { id: "difficult_conversations", name: "Difficult Conversations", description: "Assertive script template (I feel/when/because)", icon: "üó£Ô∏è" }
            ],
            nurturing: [
              { id: "fun_prompt_generator", name: "Fun Prompt Generator", description: "8 daily playful activities - silly dance, cheesy jokes!", icon: "üé≤" },
              { id: "joy_jar", name: "Digital Joy Jar", description: "Collect and revisit happy moments", icon: "üè∫" },
              { id: "fun_diary", name: "Fun & Playfulness Diary", description: "Track how much joy you're having", icon: "üìù" },
              { id: "inner_child_work", name: "Inner Child Play", description: "10 prompts to reconnect with playfulness", icon: "üß∏" },
              { id: "creative_expression_log", name: "Creative Expression Log", description: "Rate achievement, enjoyment, closeness", icon: "üé®" }
            ],
            exploring: [
              { id: "values_compass", name: "Values Compass", description: "Navigate life decisions using your core values", icon: "üß≠" },
              { id: "trigger_mapping", name: "Trigger Mapping", description: "Identify patterns and triggers for emotions", icon: "üó∫Ô∏è" },
              { id: "thought_record", name: "Thought Record (CBT)", description: "7-column format to challenge thoughts", icon: "üìù" },
              { id: "safety_behaviors", name: "Safety Behaviors", description: "Build confidence by reducing avoidance", icon: "üõ°Ô∏è" }
            ]
          };
          return tools[sectionKey] || [];
        };

        // AI Mandy Cached Prompt System
        const CACHED_MANDY_PROMPT = `You are AI Mandy, a warm and wise wellness coach who helps people get comfortable on the "cowch" - a special therapeutic couch (cow + couch wordplay). You guide users through the IMAGINE framework for wellness coaching and habit-building support:

**IMAGINE Framework:**
I - Identity & Self-Care: Nurturing authentic self-expression and personal well-being
M - Mindfulness: Present-moment awareness and grounding techniques  
A - Acceptance: Embracing what is while working toward positive change
G - Growth: Personal development and building resilience
I - Interactions: Healthy relationships and social connections
N - Nurturing: Self-compassion, playfulness, and joy
E - Exploring: Understanding thoughts, behaviors, and patterns

**Your Wellness Coaching Approach:**
- Warm, empathetic, and non-judgmental companion
- Use delightful cow puns naturally throughout conversation ("moo-ve forward", "utterly valid", "no bull", "don't have a cow", "that's pretty amoosing", "let's chew on this", "milk this moment", "graze through feelings", "pasture experiences")
- Focus on encouragement and pattern-matching insights rather than advice-giving
- Ask thoughtful questions to help users build healthy habits and discover their own strengths
- Validate emotions while gently encouraging positive habit formation
- Offer specific evidence-based techniques from the IMAGINE framework when appropriate
- Maintain clear boundaries as a coaching companion, not a therapist

**Important Boundaries:**
- You are an AI wellness coaching companion, NOT a therapist or medical professional
- Use pattern-matching to provide encouragement and habit-building support
- If someone mentions self-harm or crisis, immediately encourage professional help and provide crisis resources
- Never diagnose, treat, or replace professional therapy or medical care
- Always emphasize that you're here for coaching support and encouragement

**Communication Style:**
- Listen deeply and reflect back what you hear
- Use "I" statements to share observations
- Ask open-ended questions
- Offer gentle reframes when helpful
- Encourage small, manageable steps`;

        const generateSessionSummary = (history) => {
          if (history.length < 4) return "New session beginning";
          
          const recentMessages = history.slice(-8);
          let mood = "neutral";
          let themes = [];
          let concerns = [];
          
          // Analyze recent messages for patterns
          recentMessages.forEach(msg => {
            if (msg.sender === 'user') {
              const text = msg.text.toLowerCase();
              
              // Mood detection
              if (text.includes('anxious') || text.includes('anxiety') || text.includes('worried')) mood = "anxious";
              else if (text.includes('sad') || text.includes('depressed') || text.includes('down')) mood = "low";
              else if (text.includes('angry') || text.includes('frustrated') || text.includes('mad')) mood = "agitated";
              else if (text.includes('better') || text.includes('good') || text.includes('happy')) mood = "positive";
              
              // Theme detection
              if (text.includes('work') || text.includes('job') || text.includes('boss')) themes.push("work stress");
              if (text.includes('relationship') || text.includes('partner') || text.includes('family')) themes.push("relationships");
              if (text.includes('sleep') || text.includes('tired') || text.includes('exhausted')) themes.push("sleep/energy");
            }
          });
          
          return {
            current_mood: mood,
            session_themes: themes.slice(0, 3), // Top 3 themes
            message_count: history.length,
            needs_attention: concerns
          };
        };

        const buildConversationContext = (history, currentMessage) => {
          const recentHistory = history.slice(-6); // Last 6 messages for context
          const sessionSummary = generateSessionSummary(history);
          
          return {
            recent_conversation: recentHistory.map(msg => ({
              role: msg.sender === 'user' ? 'user' : 'assistant',
              content: msg.text
            })),
            session_context: sessionSummary,
            current_message: currentMessage
          };
        };

        const scrollToBottom = () => {
          const chatContainer = document.getElementById('chat-messages');
          if (chatContainer) {
            setTimeout(() => {
              chatContainer.scrollTop = chatContainer.scrollHeight;
            }, 100);
          }
        };

        const sendMessage = async () => {
          if (!newMessage.value.trim()) return;
          
          const userMessageText = newMessage.value;
          
          chatHistory.value.push({
            id: Date.now(),
            sender: 'user',
            text: userMessageText,
            timestamp: new Date()
          });

          newMessage.value = '';
          isTyping.value = true;
          scrollToBottom();

          // Build optimized context with caching strategy
          const context = buildConversationContext(chatHistory.value, userMessageText);

          // Call API with cached prompt system
          try {
            const response = await fetch('/api/chat', {
              method: 'POST',
              headers: {
                'Content-Type': 'application/json',
              },
              body: JSON.stringify({
                // Cached prompt (sent once, cached on server)
                system_prompt: CACHED_MANDY_PROMPT,
                use_cache: true,
                
                // Dynamic context (changes each request)
                message: userMessageText,
                recent_conversation: context.recent_conversation,
                session_context: context.session_context,
                
                // Legacy fields for backward compatibility
                conversationHistory: chatHistory.value.slice(-6),
                currentPattern: context.session_context.current_mood,
                sessionPhase: 'exploring'
              })
            });

            const data = await response.json();
            console.log('API Response:', response.status, data);

            if (response.ok && data.response) {
              chatHistory.value.push({
                id: Date.now() + 1,
                sender: 'ai_mandy',
                text: data.response,
                timestamp: new Date()
              });
              scrollToBottom();
            } else if (data.fallback) {
              // Use the API's fallback response
              chatHistory.value.push({
                id: Date.now() + 1,
                sender: 'ai_mandy',
                text: data.fallback,
                timestamp: new Date()
              });
              scrollToBottom();
            } else {
              throw new Error(`API error: ${response.status}`);
            }
          } catch (error) {
            console.error('Chat API Error:', error);
            
            // Enhanced fallback with session awareness
            const sessionInfo = generateSessionSummary(chatHistory.value);
            let fallbackResponse = "I'm having a brief technical moment, but I'm still here with you. ";
            
            if (sessionInfo.current_mood === "anxious") {
              fallbackResponse += "While I reconnect, take a slow breath with me. You're safe on this cowch.";
            } else if (sessionInfo.current_mood === "low") {
              fallbackResponse += "Sometimes technology needs a moment to regroup, just like we do. What's one thing you're feeling right now?";
            } else {
              fallbackResponse += "What's one thing you'd like to share while I get back up to speed?";
            }
            
            chatHistory.value.push({
              id: Date.now() + 1,
              sender: 'ai_mandy',
              text: fallbackResponse,
              timestamp: new Date()
            });
            scrollToBottom();
          }

          isTyping.value = false;
        };

        const selectMood = (value) => {
          selectedMood.value = value;
        };

        const saveMoodEntry = () => {
          if (!selectedMood.value) return;
          
          // Here you could save to localStorage or send to an API
          console.log('Saving mood entry:', {
            mood: selectedMood.value,
            note: moodNote.value,
            timestamp: new Date()
          });
          
          // Reset and show success
          selectedMood.value = null;
          moodNote.value = '';
          
          // Show a simple success message
          chatHistory.value.push({
            id: Date.now(),
            sender: 'system',
            text: 'MOO-d entry saved! Tracking your emotional patterns helps identify what supports your wellbeing.',
            timestamp: new Date()
          });

          // Show soothing popup
          displaySoothingMessage();

          // Switch to chat view
          currentView.value = 'chat';
        };

        // Exercise methods
        const startExercise = (tool) => {
          currentExercise.value = tool;
          currentView.value = 'exercise';
          
          // Reset exercise states
          if (tool.id === 'grounding_5432') {
            currentGroundingStep.value = 0;
            groundingCheckedItems.value = {};
          } else if (tool.id === 'breathing_4_7_8') {
            breathingActive.value = false;
            currentBreathRound.value = 1;
            breathingPhase.value = 'inhale';
            breathingCount.value = 4;
          }
        };

        const goBackToSection = () => {
          currentView.value = 'section';
          currentExercise.value = null;
        };

        const isSpecialExercise = (exerciseId) => {
          const specialExercises = [
            'grounding_5432', 'breathing_4_7_8', 'body_scan', 'energy_audit', 'three_good_things',
            'thought_unhooking', 'values_compass', 'connection_web', 'joy_jar',
            'wellness_checkin', 'fun_prompt_generator', 'fun_diary', 'inner_child_work', 'small_wins',
            'basic_acceptance', 'cow_dance_acceptance', 'self_compassion_heal',
            'radical_acceptance_1', 'radical_acceptance_2'
          ];
          return specialExercises.includes(exerciseId);
        };

        // Grounding exercise methods
        const checkGroundingItem = (stepIndex, itemIndex) => {
          if (!groundingCheckedItems.value[stepIndex]) {
            groundingCheckedItems.value[stepIndex] = {};
          }
          groundingCheckedItems.value[stepIndex][itemIndex] = true;
        };

        const canAdvanceGrounding = (stepIndex) => {
          const step = groundingSteps.value[stepIndex];
          const checkedItems = groundingCheckedItems.value[stepIndex] || {};
          const checkedCount = Object.keys(checkedItems).length;
          return checkedCount >= Math.min(2, step.items.length); // Allow advancing after checking at least 2 items
        };

        const nextGroundingStep = () => {
          if (currentGroundingStep.value < groundingSteps.value.length - 1) {
            currentGroundingStep.value++;
          } else {
            // Exercise complete
            chatHistory.value.push({
              id: Date.now(),
              sender: 'system',
              text: 'Kuh-nderbar! You just took a perfect sense-ational vaca-tion for your mind. How refreshed do you feel now?',
              timestamp: new Date()
            });
            currentView.value = 'chat';
          }
        };

        // Breathing exercise methods
        const startBreathing = () => {
          breathingActive.value = true;
          runBreathingCycle();
        };

        const stopBreathing = () => {
          breathingActive.value = false;
        };

        const runBreathingCycle = async () => {
          if (!breathingActive.value) return;
          
          // Inhale for 4 seconds
          breathingPhase.value = 'inhale';
          breathingCount.value = 4;
          breathingDuration.value = 4000;
          await new Promise(resolve => setTimeout(resolve, 4000));
          
          if (!breathingActive.value) return;
          
          // Hold for 7 seconds
          breathingPhase.value = 'hold';
          breathingCount.value = 7;
          breathingDuration.value = 7000;
          await new Promise(resolve => setTimeout(resolve, 7000));
          
          if (!breathingActive.value) return;
          
          // Exhale for 8 seconds
          breathingPhase.value = 'exhale';
          breathingCount.value = 8;
          breathingDuration.value = 8000;
          await new Promise(resolve => setTimeout(resolve, 8000));
          
          if (!breathingActive.value) return;
          
          // Next round or complete
          if (currentBreathRound.value < totalBreathRounds.value) {
            currentBreathRound.value++;
            runBreathingCycle();
          } else {
            breathingActive.value = false;
            chatHistory.value.push({
              id: Date.now(),
              sender: 'system',
              text: 'Vache-tastic! You completed your mental vaca-tion with 4 rounds of calming breathing. Notice how refreshed your mind feels now.',
              timestamp: new Date()
            });
          }
        };

        // Energy audit methods
        const addEnergyGiver = () => {
          if (newEnergyGiver.value.trim()) {
            energyGivers.value.push(newEnergyGiver.value.trim());
            newEnergyGiver.value = '';
          }
        };

        const addEnergyDrain = () => {
          if (newEnergyDrain.value.trim()) {
            energyDrains.value.push(newEnergyDrain.value.trim());
            newEnergyDrain.value = '';
          }
        };

        // Gratitude methods
        const canSaveGratitude = computed(() => {
          return threeGoodThings.value.some(thing => thing.what.trim() && thing.why.trim());
        });

        const saveGratitudeEntry = () => {
          const filledThings = threeGoodThings.value.filter(thing => thing.what.trim() && thing.why.trim());

          chatHistory.value.push({
            id: Date.now(),
            sender: 'system',
            text: `Magni-fique-cow! You recorded ${filledThings.length} meaningful things you're grateful for. This helps rewire your brain to notice more positive experiences.`,
            timestamp: new Date()
          });

          // Show soothing popup
          displaySoothingMessage();

          // Reset for next time
          threeGoodThings.value = [
            { what: '', why: '' },
            { what: '', why: '' },
            { what: '', why: '' }
          ];

          currentView.value = 'chat';
        };

        // New exercise methods

        // Thought Unhooking methods
        const completeThoughtUnhooking = () => {
          chatHistory.value.push({
            id: Date.now(),
            sender: 'system',
            text: `Mucca-nificent work unhooking from that thought! You practiced seeing it as just mental content rather than absolute truth. The action step you identified: "${actionableReframe.value}" shows you're moving from worry to empowerment.`,
            timestamp: new Date()
          });
          
          // Reset for next time
          currentBotherThought.value = '';
          selectedThoughtLabel.value = '';
          actionableReframe.value = '';
          
          currentView.value = 'chat';
        };

        // Values Compass methods
        const toggleValue = (value) => {
          const index = selectedValues.value.indexOf(value);
          if (index > -1) {
            selectedValues.value.splice(index, 1);
            delete valueReflections.value[value];
          } else if (selectedValues.value.length < 5) {
            selectedValues.value.push(value);
            valueReflections.value[value] = '';
          }
        };

        const removeValue = (value) => {
          const index = selectedValues.value.indexOf(value);
          if (index > -1) {
            selectedValues.value.splice(index, 1);
            delete valueReflections.value[value];
          }
        };

        const canCompleteValues = computed(() => {
          return selectedValues.value.length > 0 && 
                 selectedValues.value.every(value => valueReflections.value[value]?.trim());
        });

        const completeValuesExploration = () => {
          const valuesText = selectedValues.value.map(value => 
            `${value}: ${valueReflections.value[value]}`
          ).join('; ');

          chatHistory.value.push({
            id: Date.now(),
            sender: 'system',
            text: `Incroy-a-bull! You've identified your core values: ${selectedValues.value.join(', ')}. These can now serve as your compass for decision-making. When facing choices, ask: "Which option aligns best with my values?"`,
            timestamp: new Date()
          });
          
          // Reset for next time
          selectedValues.value = [];
          valueReflections.value = {};
          
          currentView.value = 'chat';
        };

        // Connection Web methods
        const addToInnerCircle = () => {
          if (newInnerPerson.value.trim() && !innerCircle.value.includes(newInnerPerson.value.trim())) {
            innerCircle.value.push(newInnerPerson.value.trim());
            newInnerPerson.value = '';
          }
        };

        const addToWiderNetwork = () => {
          if (newWiderPerson.value.trim() && !widerNetwork.value.includes(newWiderPerson.value.trim())) {
            widerNetwork.value.push(newWiderPerson.value.trim());
            newWiderPerson.value = '';
          }
        };

        const removeFromCircle = (type, index) => {
          if (type === 'inner') {
            innerCircle.value.splice(index, 1);
          } else {
            widerNetwork.value.splice(index, 1);
          }
        };

        const addConnectionAction = () => {
          const newAction = connectionActions.value.length + 1;
          connectionActions.value.push({
            id: newAction,
            person: '',
            action: '',
            when: 'this-week'
          });
        };

        const removeConnectionAction = (index) => {
          connectionActions.value.splice(index, 1);
        };

        const canSaveConnectionWeb = computed(() => {
          return (innerCircle.value.length > 0 || widerNetwork.value.length > 0) &&
                 connectionActions.value.some(action => action.person.trim() && action.action.trim());
        });

        const saveConnectionWeb = () => {
          const totalConnections = innerCircle.value.length + widerNetwork.value.length;
          const plannedActions = connectionActions.value.filter(action => action.person.trim() && action.action.trim()).length;

          chatHistory.value.push({
            id: Date.now(),
            sender: 'system',
            text: `Vachement fantastic! You've mapped ${totalConnections} meaningful connections and planned ${plannedActions} ways to strengthen relationships. Connection is the antidote to anxiety - you're building your support network beautifully.`,
            timestamp: new Date()
          });
          
          currentView.value = 'chat';
        };

        // Joy Jar methods
        const canAddJoyEntry = computed(() => {
          return currentJoyEntry.value.type && 
                 currentJoyEntry.value.level > 0 && 
                 currentJoyEntry.value.description.trim();
        });

        const addJoyEntry = () => {
          if (canAddJoyEntry.value) {
            joyEntries.value.push({
              ...currentJoyEntry.value,
              id: Date.now(),
              dateAdded: new Date()
            });
            
            // Reset form
            currentJoyEntry.value = {
              type: '',
              when: 'today',
              level: 0,
              description: ''
            };
          }
        };

        const removeJoyEntry = (index) => {
          joyEntries.value.splice(index, 1);
        };

        const getRandomJoyEntry = () => {
          if (joyEntries.value.length === 0) return null;
          const randomIndex = Math.floor(Math.random() * joyEntries.value.length);
          return joyEntries.value[randomIndex];
        };

        const saveJoyJar = () => {
          const joyCount = joyEntries.value.length;

          chatHistory.value.push({
            id: Date.now(),
            sender: 'system',
            text: `Beautiful! Your joy jar now contains ${joyCount} precious moments. Remember, joy and playfulness aren't luxuries - they're necessities for mental wellbeing. You can revisit these anytime you need a dose of happiness.`,
            timestamp: new Date()
          });

          currentView.value = 'chat';
        };

        // Fun Prompt Generator methods
        const generateFunPrompt = () => {
          const randomIndex = Math.floor(Math.random() * funPrompts.value.length);
          currentFunPrompt.value = funPrompts.value[randomIndex];
          funPromptDone.value = false;
          funPromptFeeling.value = '';
        };

        const completeFunPrompt = () => {
          funPromptDone.value = true;
          displaySoothingMessage();
        };

        // Small Wins methods
        const celebrateSmallWin = () => {
          if (smallWinText.value.trim()) {
            smallWinCompleted.value = true;
            displaySoothingMessage();
          }
        };

        const resetSmallWin = () => {
          smallWinText.value = '';
          smallWinCompleted.value = false;
        };

        // Basic Acceptance method
        const completeAcceptanceBreath = () => {
          acceptanceBreathComplete.value = true;
          displaySoothingMessage();
        };

        // Radical Acceptance methods
        const nextRadicalStep = () => {
          if (radicalAcceptanceStep.value < 5) {
            radicalAcceptanceStep.value++;
          } else {
            displaySoothingMessage();
          }
        };

        const resetRadicalAcceptance = () => {
          radicalAcceptanceStep.value = 1;
          radicalSituation.value = '';
        };

        // Body Scan methods
        const nextBodyScanStep = () => {
          if (bodyScanStep.value < muscleGroups.value.length - 1) {
            bodyScanStep.value++;
          } else {
            bodyScanComplete.value = true;
            displaySoothingMessage();
          }
        };

        const resetBodyScan = () => {
          bodyScanStep.value = 0;
          bodyScanComplete.value = false;
        };

        // H-E-A-L Framework method
        const completeHealExercise = () => {
          displaySoothingMessage();
          chatHistory.value.push({
            id: Date.now(),
            sender: 'system',
            text: `H-E-A-L practice complete! You've practiced genuine self-compassion. Remember: being kind to yourself changes your brain chemistry. You deserve the same compassion you'd give a friend.`,
            timestamp: new Date()
          });
          // Reset for next time
          healSituation.value = '';
          healHelpful.value = '';
          healEvidence.value = '';
          healAlternative.value = '';
          healLovedOne.value = '';
        };

        // Fun & Playfulness Diary method
        const saveFunDiary = () => {
          displaySoothingMessage();
          chatHistory.value.push({
            id: Date.now(),
            sender: 'system',
            text: `Fun diary saved! ${funDiaryFeeling.value} Playfulness and joy aren't luxuries‚Äîthey're essential for wellbeing. Keep noticing those moments of lightness!`,
            timestamp: new Date()
          });
          // Reset for next time
          funDiaryActivity.value = '';
          funDiaryPlayful.value = '';
          funDiaryFeeling.value = 'üòä';
        };

        // Inner Child Work method
        const completeInnerChildWork = () => {
          displaySoothingMessage();
          chatHistory.value.push({
            id: Date.now(),
            sender: 'system',
            text: `Inner Child work complete! ${innerChildFeeling.value} You've reconnected with the playful, spontaneous part of yourself. Remember: play isn't frivolous‚Äîit's healing.`,
            timestamp: new Date()
          });
          // Reset for next time
          selectedInnerChildPrompt.value = '';
          innerChildReflection.value = '';
          innerChildFeeling.value = '';
        };

        // Wellness Check-In method
        const saveWellnessCheckin = () => {
          displaySoothingMessage();
          chatHistory.value.push({
            id: Date.now(),
            sender: 'system',
            text: `Wellness check-in complete! You've taken an important step in self-awareness. ${wellnessMood.value < 6 ? 'Your mood is a bit low - consider: taking a walk, listening to happy music, calling a friend, playing with a pet, or thinking about something that makes you smile.' : 'Great to see you\'re feeling good!'}`,
            timestamp: new Date()
          });
        };

        // Fetch quotes from Mandy's blog
        const fetchBlogQuotes = async () => {
          try {
            isLoadingQuote.value = true;
            
            // Try to fetch from thoughtsonlifeandlove.com using a CORS proxy or direct fetch
            const response = await fetch('/api/blog-quotes', {
              method: 'GET',
              headers: {
                'Content-Type': 'application/json',
              }
            });
            
            if (response.ok) {
              const data = await response.json();
              if (data.quotes && data.quotes.length > 0) {
                blogQuotes.value = data.quotes;
                return true;
              }
            }
          } catch (error) {
            console.log('Blog quotes not available, using authentic fallbacks:', error);
          } finally {
            isLoadingQuote.value = false;
          }
          return false;
        };

        // Moove with Mandy quotes function
        const getNewQuote = async () => {
          isLoadingQuote.value = true;
          
          // Try blog quotes first, fall back to authentic quotes
          let quotesArray = blogQuotes.value.length > 0 ? blogQuotes.value : authenticQuotes.value;
          
          if (blogQuotes.value.length === 0) {
            // Try to fetch fresh blog content
            const fetched = await fetchBlogQuotes();
            if (fetched) {
              quotesArray = blogQuotes.value;
            }
          }
          
          const randomIndex = Math.floor(Math.random() * quotesArray.length);
          currentQuote.value = quotesArray[randomIndex];
          isLoadingQuote.value = false;
        };

        // Initialize with a quote on page load
        const initializeQuote = async () => {
          await getNewQuote();
        };

        // Initialize quote immediately
        initializeQuote();

        return {
          currentView,
          currentSection,
          currentExercise,
          newMessage,
          isTyping,
          selectedMood,
          moodNote,
          moodOptions,
          imagineSections,
          groundingSteps,
          chatHistory,
          chatWithMandy,
          exploreImagine,
          showMoodTracker,
          goHome,
          goToSection,
          getSectionGuidance,
          getSectionTools,
          sendMessage,
          selectMood,
          saveMoodEntry,
          // Exercise methods and data
          startExercise,
          goBackToSection,
          isSpecialExercise,
          currentGroundingStep,
          checkGroundingItem,
          canAdvanceGrounding,
          nextGroundingStep,
          breathingActive,
          breathingPhase,
          breathingCount,
          breathingDuration,
          currentBreathRound,
          totalBreathRounds,
          startBreathing,
          stopBreathing,
          energyGivers,
          energyDrains,
          newEnergyGiver,
          newEnergyDrain,
          addEnergyGiver,
          addEnergyDrain,
          threeGoodThings,
          canSaveGratitude,
          saveGratitudeEntry,
          // New exercise variables and methods
          currentBotherThought,
          selectedThoughtLabel,
          thoughtLabels,
          actionableReframe,
          completeThoughtUnhooking,
          selectedValues,
          valueReflections,
          availableValues,
          toggleValue,
          removeValue,
          canCompleteValues,
          completeValuesExploration,
          innerCircle,
          widerNetwork,
          newInnerPerson,
          newWiderPerson,
          connectionActions,
          addToInnerCircle,
          addToWiderNetwork,
          removeFromCircle,
          addConnectionAction,
          removeConnectionAction,
          canSaveConnectionWeb,
          saveConnectionWeb,
          joyEntries,
          currentJoyEntry,
          canAddJoyEntry,
          addJoyEntry,
          removeJoyEntry,
          getRandomJoyEntry,
          saveJoyJar,
          // Wellness Check-In
          wellnessMood,
          wellnessExercise,
          wellnessDiet,
          wellnessAppearance,
          wellnessImprovements,
          saveWellnessCheckin,
          // Fun Prompt Generator
          funPrompts,
          currentFunPrompt,
          funPromptDone,
          funPromptFeeling,
          generateFunPrompt,
          completeFunPrompt,
          // Gratitude Small Wins
          smallWinText,
          smallWinCompleted,
          celebrateSmallWin,
          resetSmallWin,
          // Basic Acceptance
          acceptanceBreathComplete,
          completeAcceptanceBreath,
          // Cow-dance Acceptance
          cowDanceSituation,
          cowDanceAccepting,
          // Radical Acceptance
          radicalSituation,
          radicalAcceptanceStep,
          radicalExercise2Struggle,
          nextRadicalStep,
          resetRadicalAcceptance,
          // Body Scan
          bodyScanStep,
          bodyScanComplete,
          muscleGroups,
          nextBodyScanStep,
          resetBodyScan,
          // H-E-A-L Framework
          healSituation,
          healHelpful,
          healEvidence,
          healAlternative,
          healLovedOne,
          completeHealExercise,
          // Fun & Playfulness Diary
          funDiaryDate,
          funDiaryActivity,
          funDiaryPlayful,
          funDiaryFeeling,
          saveFunDiary,
          // Inner Child Work
          innerChildPrompts,
          selectedInnerChildPrompt,
          innerChildReflection,
          innerChildFeeling,
          completeInnerChildWork,
          // Moove with Mandy quotes
          currentQuote,
          blogQuotes,
          authenticQuotes,
          // Soothing messages
          showSoothingPopup,
          currentSoothingMessage,
          displaySoothingMessage,
          isLoadingQuote,
          getNewQuote,
          fetchBlogQuotes
        };
      }
    }).mount('#app');

    // Register Service Worker for PWA functionality
    if ('serviceWorker' in navigator) {
      window.addEventListener('load', () => {
        navigator.serviceWorker.register('/sw.js')
          .then((registration) => {
            console.log('SW registered: ', registration);
            
            // Request notification permission for daily mootivations
            requestNotificationPermission();
          })
          .catch((registrationError) => {
            console.log('SW registration failed: ', registrationError);
          });
      });
    }

    // Request notification permission for daily mootivations
    async function requestNotificationPermission() {
      if ('Notification' in window && 'serviceWorker' in navigator) {
        // Wait a bit before asking for permissions
        setTimeout(async () => {
          if (Notification.permission === 'default') {
            // Show a friendly explanation first
            const notificationBanner = document.createElement('div');
            notificationBanner.className = 'fixed bottom-4 left-4 right-4 z-50 p-4 bg-gradient-to-r from-purple-500 to-pink-500 rounded-2xl shadow-lg text-white text-center';
            notificationBanner.innerHTML = `
              <div class="flex items-center justify-between">
                <div class="flex items-center space-x-3">
                  <span class="text-2xl">üêÑüíù</span>
                  <div class="text-left">
                    <p class="font-semibold text-sm">Get Daily Moo-tivations!</p>
                    <p class="text-xs opacity-80">Like having a therapeutic pet cow in your pocket ü•∞</p>
                  </div>
                </div>
                <div class="flex space-x-2">
                  <button id="notifications-dismiss" class="px-3 py-1 text-xs bg-black/20 rounded-full">Maybe later</button>
                  <button id="notifications-allow" class="px-4 py-1 text-xs bg-white/20 rounded-full font-medium">Yes please!</button>
                </div>
              </div>
            `;
            
            document.body.appendChild(notificationBanner);
            
            document.getElementById('notifications-allow').addEventListener('click', async () => {
              const permission = await Notification.requestPermission();
              if (permission === 'granted') {
                console.log('Notifications enabled! Daily mootivations activated! üêÑüíù');
              }
              notificationBanner.remove();
            });
            
            document.getElementById('notifications-dismiss').addEventListener('click', () => {
              notificationBanner.remove();
            });
            
            // Auto-dismiss after 12 seconds
            setTimeout(() => {
              if (document.body.contains(notificationBanner)) {
                notificationBanner.remove();
              }
            }, 12000);
          }
        }, 8000); // Wait 8 seconds after app loads
      }
    }

    // PWA Install Prompt
    let deferredPrompt;
    let hasShownPrompt = localStorage.getItem('cowch-install-dismissed') === 'true';
    
    window.addEventListener('beforeinstallprompt', (e) => {
      e.preventDefault();
      deferredPrompt = e;
      
      // Show install button after a delay if not dismissed
      if (!hasShownPrompt) {
        setTimeout(() => {
          if (deferredPrompt && !window.matchMedia('(display-mode: standalone)').matches) {
            showInstallPrompt();
          }
        }, 3000);
      }
    });
    
    // Also show prompt on page load if available and not dismissed
    window.addEventListener('load', () => {
      setTimeout(() => {
        if (!hasShownPrompt && !window.matchMedia('(display-mode: standalone)').matches) {
          // Check if install is available (some browsers don't fire beforeinstallprompt)
          if ('serviceWorker' in navigator && 'PushManager' in window) {
            showGenericInstallPrompt();
          }
        }
      }, 5000);
    });

    function showInstallPrompt() {
      if (!deferredPrompt) return;
      
      const installBanner = document.createElement('div');
      installBanner.className = 'fixed bottom-4 left-4 right-4 z-50 p-4 bg-gradient-to-r from-indigo-500 to-purple-500 rounded-2xl shadow-lg text-white text-center';
      installBanner.innerHTML = `
        <div class="flex items-center justify-between">
          <div class="flex items-center space-x-3">
            <span class="text-2xl">üêÑ</span>
            <div class="text-left">
              <p class="font-semibold text-sm">Moo-ve Cowch to your home screen!</p>
              <p class="text-xs opacity-80">For the udderly best cowch experience üõãÔ∏è</p>
            </div>
          </div>
          <div class="flex space-x-2">
            <button id="install-dismiss" class="px-3 py-1 text-xs bg-black/20 rounded-full">Maybe later</button>
            <button id="install-app" class="px-4 py-1 text-xs bg-white/20 rounded-full font-medium">Add to cowch</button>
          </div>
        </div>
      `;
      
      document.body.appendChild(installBanner);
      
      document.getElementById('install-app').addEventListener('click', async () => {
        if (deferredPrompt) {
          deferredPrompt.prompt();
          const result = await deferredPrompt.userChoice;
          deferredPrompt = null;
          installBanner.remove();
        }
      });
      
      document.getElementById('install-dismiss').addEventListener('click', () => {
        installBanner.remove();
        localStorage.setItem('cowch-install-dismissed', 'true');
        hasShownPrompt = true;
      });
      
      // Auto-dismiss after 15 seconds
      setTimeout(() => {
        if (document.body.contains(installBanner)) {
          installBanner.remove();
        }
      }, 15000);
    }

    function showGenericInstallPrompt() {
      const installBanner = document.createElement('div');
      installBanner.className = 'fixed bottom-4 left-4 right-4 z-50 p-4 bg-gradient-to-r from-indigo-500 to-purple-500 rounded-2xl shadow-lg text-white text-center';
      installBanner.innerHTML = `
        <div class="flex items-center justify-between">
          <div class="flex items-center space-x-3">
            <span class="text-2xl">üêÑ</span>
            <div class="text-left">
              <p class="font-semibold text-sm">Moo-ve Cowch to your home screen!</p>
              <p class="text-xs opacity-80">Use your browser's "Add to Home Screen" option üõãÔ∏è</p>
            </div>
          </div>
          <div class="flex space-x-2">
            <button id="generic-install-dismiss" class="px-3 py-1 text-xs bg-black/20 rounded-full">Got it</button>
          </div>
        </div>
      `;
      
      document.body.appendChild(installBanner);
      
      document.getElementById('generic-install-dismiss').addEventListener('click', () => {
        installBanner.remove();
        localStorage.setItem('cowch-install-dismissed', 'true');
        hasShownPrompt = true;
      });
      
      // Auto-dismiss after 8 seconds
      setTimeout(() => {
        if (document.body.contains(installBanner)) {
          installBanner.remove();
        }
      }, 8000);
    }
  </script>
</body>
</html>