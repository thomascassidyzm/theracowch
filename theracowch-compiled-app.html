<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>current_imagine_section_name</title>
  <script src="https://unpkg.com/vue@3/dist/vue.global.js"></script>
  <script src="https://cdn.tailwindcss.com"></script>
  <style>
    
    body {
      font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, sans-serif;
      padding-bottom: 80px;
      background: var(--gradient-simple);
      margin: 0;
    }
    
    .theracowch-app {
      font-family: -apple-system, BlinkMacSystemFont, 'SF Pro Display', 'Segoe UI', Roboto, sans-serif;
      min-height: 100vh;
      background: var(--bg-dark);
      position: relative;
    }
    
    .theracowch-app::before {
      content: '';
      position: fixed;
      top: 0;
      left: 0;
      right: 0;
      bottom: 0;
      background: 
        radial-gradient(circle at 20% 80%, rgba(139, 92, 246, 0.3) 0%, transparent 50%),
        radial-gradient(circle at 80% 20%, rgba(0, 212, 255, 0.3) 0%, transparent 50%),
        radial-gradient(circle at 40% 40%, rgba(16, 185, 129, 0.2) 0%, transparent 50%);
      pointer-events: none;
      z-index: 0;
    }
    
    :root {
      --glass-bg: rgba(255, 255, 255, 0.1);
      --glass-border: rgba(255, 255, 255, 0.2);
      --glass-shadow: rgba(0, 0, 0, 0.1);
      --neon-blue: #00D4FF;
      --neon-purple: #8B5CF6;
      --neon-pink: #EC4899;
      --neon-green: #10B981;
      --neon-orange: #F59E0B;
      --neon-red: #EF4444;
      --neon-cyan: #06B6D4;
      --text-glass: rgba(255, 255, 255, 0.9);
      --text-glass-soft: rgba(255, 255, 255, 0.7);
      --text-glass-muted: rgba(255, 255, 255, 0.5);
      --bg-dark: linear-gradient(135deg, #0F0C29 0%, #24243e 50%, #2b5876 100%);
      --shadow-glow: 0 8px 32px rgba(0, 0, 0, 0.3);
      --border-radius-modern: 24px;
    }
    
    /* Rootd-style fun cards */
    .wysa-card {
      background: var(--glass-bg);
      border-radius: var(--border-radius-modern);
      padding: 28px;
      box-shadow: var(--shadow-glow);
      margin-bottom: 24px;
      backdrop-filter: blur(20px);
      border: 1px solid var(--glass-border);
      position: relative;
      z-index: 1;
      transition: all 0.3s cubic-bezier(0.4, 0, 0.2, 1);
    }
    
    .wysa-card:hover {
      transform: translateY(-4px);
      box-shadow: 0 12px 48px rgba(0, 0, 0, 0.4);
      border-color: rgba(255, 255, 255, 0.3);
    }
    
    /* Therapeutic cow character styling */
    .cow-character-illustration {
      width: 80px;
      height: 80px;
      position: relative;
    }
    
    .cow-placeholder {
      width: 80px;
      height: 80px;
      background: linear-gradient(135deg, #FFE4B5 0%, #DEB887 100%);
      border-radius: 50%;
      display: flex;
      align-items: center;
      justify-content: center;
      font-size: 32px;
      border: 3px solid rgba(255, 255, 255, 0.8);
      box-shadow: 0 6px 20px rgba(0,0,0,0.1);
      position: relative;
    }
    
    .cow-image {
      width: 80px;
      height: 80px;
      border-radius: 50%;
      border: 3px solid rgba(255, 255, 255, 0.8);
      box-shadow: 0 6px 20px rgba(0,0,0,0.1);
      object-fit: cover;
    }
    
    /* Simplified consistent buttons */
    .wysa-button {
      background: linear-gradient(135deg, var(--neon-blue) 0%, var(--neon-cyan) 100%);
      color: white;
      border: none;
      border-radius: var(--border-radius-modern);
      padding: 18px 28px;
      font-weight: 600;
      font-size: 15px;
      cursor: pointer;
      box-shadow: 0 8px 32px rgba(0, 212, 255, 0.3);
      transition: all 0.3s cubic-bezier(0.4, 0, 0.2, 1);
      backdrop-filter: blur(10px);
      border: 1px solid rgba(0, 212, 255, 0.2);
      position: relative;
      overflow: hidden;
    }
    
    .wysa-button::before {
      content: '';
      position: absolute;
      top: 0;
      left: -100%;
      width: 100%;
      height: 100%;
      background: linear-gradient(90deg, transparent, rgba(255, 255, 255, 0.2), transparent);
      transition: left 0.5s;
    }
    
    .wysa-button:hover::before {
      left: 100%;
    }
    
    .wysa-button:hover {
      transform: translateY(-4px);
      box-shadow: 0 12px 48px rgba(0, 212, 255, 0.4);
      border-color: rgba(0, 212, 255, 0.4);
    }
    
    .wysa-button-secondary {
      background: var(--glass-bg);
      color: var(--text-glass);
      border: 1px solid var(--glass-border);
      border-radius: var(--border-radius-modern);
      padding: 16px 24px;
      font-weight: 500;
      cursor: pointer;
      transition: all 0.3s cubic-bezier(0.4, 0, 0.2, 1);
      backdrop-filter: blur(20px);
    }
    
    .wysa-button-secondary:hover {
      border-color: var(--neon-cyan);
      color: var(--neon-cyan);
      box-shadow: 0 8px 32px rgba(6, 182, 212, 0.2);
      transform: translateY(-2px);
    }
    
    /* Progress indicators */
    .progress-circle {
      width: 40px;
      height: 40px;
      border-radius: 50%;
      background: conic-gradient(var(--teal-character) 0deg, var(--light-purple) 0deg);
      display: flex;
      align-items: center;
      justify-content: center;
      font-size: 12px;
      font-weight: bold;
      color: var(--text-dark);
    }
    
    /* IMAGINE horizontal cards */
    .imagine-horizontal-card {
      border-radius: 20px;
      box-shadow: 0 6px 25px rgba(0,0,0,0.15);
      transition: all 0.3s cubic-bezier(0.4, 0, 0.2, 1);
      cursor: pointer;
      position: relative;
      overflow: hidden;
      border: 2px solid rgba(255, 255, 255, 0.2);
    }
    
    .imagine-horizontal-card:hover {
      transform: translateY(-2px) scale(1.01);
      box-shadow: 0 10px 35px rgba(0,0,0,0.2);
      border-color: rgba(255, 255, 255, 0.4);
    }
    
    /* Consistent dark gradients for IMAGINE sections */
    .gradient-self-care,
    .gradient-mindfulness,
    .gradient-acceptance,
    .gradient-gratitude,
    .gradient-interactions,
    .gradient-nurturing,
    .gradient-exploring {
      background: linear-gradient(135deg, var(--primary-dark) 0%, var(--secondary-dark) 100%);
    }
    
    /* Slight variations for distinction */
    .gradient-self-care { 
      background: linear-gradient(135deg, var(--neon-red) 0%, var(--neon-pink) 100%); 
      color: white; 
      border: 1px solid rgba(239, 68, 68, 0.3);
      box-shadow: 0 8px 32px rgba(239, 68, 68, 0.2);
    }
    .gradient-mindfulness { 
      background: linear-gradient(135deg, var(--neon-blue) 0%, var(--neon-cyan) 100%); 
      color: white; 
      border: 1px solid rgba(0, 212, 255, 0.3);
      box-shadow: 0 8px 32px rgba(0, 212, 255, 0.2);
    }
    .gradient-acceptance { 
      background: linear-gradient(135deg, var(--neon-purple) 0%, var(--neon-pink) 100%); 
      color: white; 
      border: 1px solid rgba(139, 92, 246, 0.3);
      box-shadow: 0 8px 32px rgba(139, 92, 246, 0.2);
    }
    .gradient-gratitude { 
      background: linear-gradient(135deg, var(--neon-orange) 0%, var(--neon-red) 100%); 
      color: white; 
      border: 1px solid rgba(245, 158, 11, 0.3);
      box-shadow: 0 8px 32px rgba(245, 158, 11, 0.2);
    }
    .gradient-interactions { 
      background: linear-gradient(135deg, var(--neon-pink) 0%, var(--neon-purple) 100%); 
      color: white; 
      border: 1px solid rgba(236, 72, 153, 0.3);
      box-shadow: 0 8px 32px rgba(236, 72, 153, 0.2);
    }
    .gradient-nurturing { 
      background: linear-gradient(135deg, var(--neon-green) 0%, var(--neon-cyan) 100%); 
      color: white; 
      border: 1px solid rgba(16, 185, 129, 0.3);
      box-shadow: 0 8px 32px rgba(16, 185, 129, 0.2);
    }
    .gradient-exploring { 
      background: linear-gradient(135deg, var(--neon-cyan) 0%, var(--neon-blue) 100%); 
      color: white; 
      border: 1px solid rgba(6, 182, 212, 0.3);
      box-shadow: 0 8px 32px rgba(6, 182, 212, 0.2);
    }
    
    /* Navigation styling */
    .bottom-nav {
      background: var(--card-white);
      border-top: 1px solid rgba(184, 169, 255, 0.1);
      backdrop-filter: blur(10px);
    }
    
    .nav-icon {
      width: 24px;
      height: 24px;
      margin-bottom: 4px;
    }
    
    /* Chat interface */
    .chat-bubble-user {
      background: var(--teal-character);
      color: white;
      border-radius: 18px 18px 4px 18px;
      padding: 12px 16px;
      max-width: 80%;
      margin-left: auto;
      margin-bottom: 12px;
    }
    
    .chat-bubble-ai {
      background: var(--card-white);
      color: var(--text-dark);
      border-radius: 18px 18px 18px 4px;
      padding: 12px 16px;
      max-width: 80%;
      margin-right: auto;
      margin-bottom: 12px;
      box-shadow: 0 2px 10px var(--shadow-soft);
    }
    
    /* Mood tracking */
    .mood-slider {
      width: 100%;
      height: 8px;
      border-radius: 4px;
      background: linear-gradient(90deg, var(--coral-accent), var(--warm-yellow), var(--teal-character));
      appearance: none;
      outline: none;
    }
    
    .mood-slider::-webkit-slider-thumb {
      appearance: none;
      width: 24px;
      height: 24px;
      border-radius: 50%;
      background: var(--card-white);
      border: 3px solid var(--teal-character);
      cursor: pointer;
      box-shadow: 0 2px 8px var(--shadow-soft);
    }
    
    /* Custom scrollbar */
    ::-webkit-scrollbar {
      width: 4px;
    }
    
    ::-webkit-scrollbar-track {
      background: rgba(184, 169, 255, 0.1);
    }
    
    ::-webkit-scrollbar-thumb {
      background: var(--teal-character);
      border-radius: 2px;
    }
    
    /* Fun Rootd-style animations */
    @keyframes float {
      0%, 100% { transform: translateY(0px) rotate(0deg); }
      33% { transform: translateY(-8px) rotate(2deg); }
      66% { transform: translateY(-12px) rotate(-2deg); }
    }
    
    @keyframes pulse {
      0%, 100% { transform: scale(1); }
      50% { transform: scale(1.05); }
    }
    
    @keyframes rainbow {
      0% { filter: hue-rotate(0deg); }
      100% { filter: hue-rotate(360deg); }
    }
    
    @keyframes bounce-in {
      0% { transform: scale(0.3) rotate(-45deg); opacity: 0; }
      50% { transform: scale(1.1) rotate(5deg); }
      100% { transform: scale(1) rotate(0deg); opacity: 1; }
    }
    
    .floating {
      animation: float 4s ease-in-out infinite;
    }
    
    .pulsing {
      animation: pulse 2s ease-in-out infinite;
    }
    
    .rainbow-glow {
      animation: rainbow 3s linear infinite;
    }
    
    .bounce-in {
      animation: bounce-in 0.6s cubic-bezier(0.68, -0.55, 0.265, 1.55);
    }
    
    .text-shadow {
      text-shadow: 0 2px 4px rgba(0,0,0,0.3);
    }
    
    /* Fun emojis and icons */
    .emoji-bounce {
      display: inline-block;
      animation: bounce-in 0.8s ease-out;
    }
    
    .progress-circle {
      width: 50px;
      height: 50px;
      border-radius: 50%;
      display: flex;
      align-items: center;
      justify-content: center;
      font-size: 14px;
      font-weight: bold;
      border: 3px solid rgba(255, 255, 255, 0.5);
      backdrop-filter: blur(5px);
    }
    
    /* Photo Upload Styling */
    .photo-upload-area {
      border-radius: 16px;
      overflow: hidden;
      background: rgba(255, 255, 255, 0.05);
      border: 2px dashed rgba(78, 205, 196, 0.3);
      transition: all 0.3s ease;
    }
    
    .photo-upload-placeholder {
      padding: 32px 24px;
      text-align: center;
      cursor: pointer;
      transition: all 0.3s ease;
      background: linear-gradient(135deg, rgba(78, 205, 196, 0.1) 0%, rgba(129, 199, 212, 0.1) 100%);
    }
    
    .photo-upload-placeholder:hover {
      background: linear-gradient(135deg, rgba(78, 205, 196, 0.2) 0%, rgba(129, 199, 212, 0.2) 100%);
      border-color: rgba(78, 205, 196, 0.5);
      transform: translateY(-2px);
    }
    
    .upload-icon {
      font-size: 48px;
      margin-bottom: 12px;
      opacity: 0.8;
      animation: pulse 2s ease-in-out infinite;
    }
    
    .upload-text {
      font-size: 18px;
      font-weight: 600;
      color: var(--text-dark);
      margin-bottom: 4px;
    }
    
    .upload-hint {
      font-size: 14px;
      color: var(--text-medium);
      opacity: 0.8;
    }
    
    .photo-preview-container {
      position: relative;
      border-radius: 16px;
      overflow: hidden;
      background: var(--white);
      box-shadow: 0 8px 32px rgba(0,0,0,0.1);
    }
    
    .photo-preview {
      width: 100%;
      height: 200px;
      object-fit: cover;
      border-radius: 16px 16px 0 0;
    }
    
    .photo-actions {
      padding: 16px;
      display: flex;
      gap: 12px;
      background: linear-gradient(135deg, rgba(78, 205, 196, 0.05) 0%, rgba(129, 199, 212, 0.05) 100%);
    }
    
    .change-photo-btn {
      flex: 1;
      padding: 12px 16px;
      background: linear-gradient(135deg, var(--teal-primary) 0%, var(--blue-soft) 100%);
      color: white;
      border: none;
      border-radius: 12px;
      font-weight: 600;
      font-size: 14px;
      cursor: pointer;
      transition: all 0.3s ease;
      box-shadow: 0 4px 15px rgba(78, 205, 196, 0.2);
    }
    
    .change-photo-btn:hover {
      transform: translateY(-2px);
      box-shadow: 0 6px 20px rgba(78, 205, 196, 0.3);
    }
    
    .remove-photo-btn {
      padding: 12px 16px;
      background: linear-gradient(135deg, #E74C3C 0%, #C0392B 100%);
      color: white;
      border: none;
      border-radius: 12px;
      font-weight: 600;
      font-size: 14px;
      cursor: pointer;
      transition: all 0.3s ease;
      box-shadow: 0 4px 15px rgba(231, 76, 60, 0.2);
    }
    
    .remove-photo-btn:hover {
      transform: translateY(-2px);
      box-shadow: 0 6px 20px rgba(231, 76, 60, 0.3);
    }
    
    /* Enhanced animations for photo upload */
    @keyframes photoUpload {
      0% { transform: scale(0.8) rotate(-5deg); opacity: 0; }
      50% { transform: scale(1.05) rotate(2deg); }
      100% { transform: scale(1) rotate(0deg); opacity: 1; }
    }
    
    .photo-preview-container {
      animation: photoUpload 0.6s cubic-bezier(0.68, -0.55, 0.265, 1.55);
    }
    
    /* Hidden file input */
    .hidden {
      display: none;
    }

    /* Enhanced Chat Interface Styling */
    .chat-message-enter-active {
      transition: all 0.3s ease-out;
    }
    
    .chat-message-enter-from {
      opacity: 0;
      transform: translateY(10px);
    }
    
    .chat-message-enter-to {
      opacity: 1;
      transform: translateY(0);
    }
    
    /* Therapeutic Typing Indicator */
    @keyframes typing-bounce {
      0%, 60%, 100% {
        transform: translateY(0);
      }
      30% {
        transform: translateY(-10px);
      }
    }
    
    .animate-bounce {
      animation: typing-bounce 1.4s infinite;
    }
    
    /* Enhanced Message Bubbles */
    .chat-bubble {
      position: relative;
      animation: fadeInUp 0.3s ease-out;
    }
    
    .chat-bubble::before {
      content: '';
      position: absolute;
      width: 0;
      height: 0;
    }
    
    /* User message tail */
    .chat-bubble.user::before {
      right: -8px;
      top: 12px;
      border-left: 8px solid #8B5CF6;
      border-top: 4px solid transparent;
      border-bottom: 4px solid transparent;
    }
    
    /* AI message tail */
    .chat-bubble.ai::before {
      left: -8px;
      top: 12px;
      border-right: 8px solid white;
      border-top: 4px solid transparent;
      border-bottom: 4px solid transparent;
    }
    
    /* Therapeutic Status Indicators */
    .therapy-indicator {
      display: inline-block;
      width: 8px;
      height: 8px;
      border-radius: 50%;
      margin-right: 4px;
    }
    
    .therapy-indicator.listening {
      background-color: #10B981;
    }
    
    .therapy-indicator.exploring {
      background-color: #F59E0B;
    }
    
    .therapy-indicator.deepening {
      background-color: #8B5CF6;
    }
    
    .therapy-indicator.integrating {
      background-color: #EF4444;
    }
    
    /* Coping Strategy Cards */
    .coping-strategy-card {
      background: linear-gradient(135deg, rgba(59, 130, 246, 0.1) 0%, rgba(139, 92, 246, 0.1) 100%);
      border: 1px solid rgba(59, 130, 246, 0.2);
      border-radius: 8px;
      padding: 8px 12px;
      margin: 4px 0;
      font-size: 0.875rem;
      transition: all 0.2s ease;
    }
    
    .coping-strategy-card:hover {
      background: linear-gradient(135deg, rgba(59, 130, 246, 0.15) 0%, rgba(139, 92, 246, 0.15) 100%);
      border-color: rgba(59, 130, 246, 0.3);
    }
    
    /* IMAGINE Section Quick Access */
    .imagine-quick-access {
      background: linear-gradient(135deg, rgba(147, 51, 234, 0.1) 0%, rgba(79, 70, 229, 0.1) 100%);
      border: 1px solid rgba(147, 51, 234, 0.2);
      border-radius: 6px;
      padding: 4px 8px;
      font-size: 0.75rem;
      transition: all 0.2s ease;
    }
    
    .imagine-quick-access:hover {
      background: linear-gradient(135deg, rgba(147, 51, 234, 0.15) 0%, rgba(79, 70, 229, 0.15) 100%);
      border-color: rgba(147, 51, 234, 0.3);
    }
    
    /* Enhanced animations */
    @keyframes fadeInUp {
      from {
        opacity: 0;
        transform: translateY(15px);
      }
      to {
        opacity: 1;
        transform: translateY(0);
      }
    }
    
    /* Therapeutic Session Progress */
    .session-progress {
      background: linear-gradient(90deg, #10B981 0%, #F59E0B 25%, #8B5CF6 50%, #EF4444 75%, #10B981 100%);
      height: 2px;
      border-radius: 1px;
      opacity: 0.3;
    }
    
    /* Message Pattern Indicators */
    .pattern-indicator {
      font-size: 0.625rem;
      color: rgba(107, 114, 128, 0.7);
      font-style: italic;
    }
    
    .pattern-indicator.anxiety {
      color: rgba(239, 68, 68, 0.7);
    }
    
    .pattern-indicator.depression {
      color: rgba(59, 130, 246, 0.7);
    }
    
    .pattern-indicator.perfectionism {
      color: rgba(139, 92, 246, 0.7);
    }
    
    .pattern-indicator.general {
      color: rgba(16, 185, 129, 0.7);
    }

    /* Mobile-first responsive design */
    @media (max-width: 640px) {
      .max-w-lg {
        max-width: 100%;
        margin: 0;
      }
      
      .wysa-card {
        margin: 8px;
        border-radius: 12px;
      }
      
      .photo-preview {
        height: 160px;
      }
      
      .photo-actions {
        padding: 12px;
        gap: 8px;
      }
      
      .change-photo-btn,
      .remove-photo-btn {
        padding: 10px 12px;
        font-size: 13px;
      }
      
      .upload-icon {
        font-size: 40px;
      }
      
      .upload-text {
        font-size: 16px;
      }
    }
  </style>
</head>
<body class="bg-gray-50">
  <div id="app">
    
    <!-- Theracowch App Template -->
    <div class="theracowch-app min-h-screen">
      <!-- Fun Navigation Bar -->
      <nav class="fixed top-0 left-0 right-0 z-50" style="background: var(--glass-bg); backdrop-filter: blur(20px); border-bottom: 1px solid var(--glass-border);">
        <div class="max-w-lg mx-auto px-6 py-6">
          <div class="flex items-center justify-between">
            <h1 class="text-2xl font-bold flex items-center" style="color: var(--text-glass)">
              <div class="w-10 h-10 bg-gradient-to-br from-neon-blue to-neon-purple rounded-full mr-3 flex items-center justify-center text-white font-bold shadow-lg">🐄</div> 
              Theracowch
            </h1>
            <div class="text-sm font-medium flex items-center gap-2" style="color: var(--text-glass-soft)">
              <div class="w-2 h-2 bg-neon-green rounded-full animate-pulse"></div>
              Online
            </div>
          </div>
        </div>
      </nav>

      <!-- Dashboard Content -->
      <main class="max-w-lg mx-auto p-4 pt-24" v-if="currentView === 'dashboard'">
        <!-- AI Mandy Greeting -->
        <div class="wysa-card mb-6">
          <div class="flex items-center mb-3">
            <div class="cow-character-illustration mr-4 floating">
              <div class="w-16 h-16 bg-gradient-to-br from-neon-pink to-neon-purple rounded-full flex items-center justify-center text-2xl">🐄</div>
            </div>
            <div>
              <h2 class="font-bold text-xl" style="color: var(--text-glass)">AI Mandy</h2>
              <p class="text-sm font-medium" style="color: var(--text-glass-soft)">Your therapeutic coaching companion</p>
            </div>
          </div>
          <p class="text-base leading-relaxed" style="color: var(--text-glass-soft)">{{ aiMandyGreeting }}</p>
        </div>

        <!-- Daily Quote -->
        <div class="wysa-card mb-6">
          <h3 class="font-semibold mb-3 flex items-center" style="color: var(--text-glass)"><div class="w-6 h-6 bg-gradient-to-br from-neon-orange to-neon-red rounded-full mr-2 flex items-center justify-center text-sm">✨</div> Daily Inspiration</h3>
          <blockquote class="italic mb-4 text-lg leading-relaxed" style="color: var(--text-glass-soft)">{{ dailyQuote.text }}</blockquote>
          <p class="text-sm font-medium" style="color: var(--text-glass-muted)">- {{ dailyQuote.author }}</p>
          <button @click="getNewQuote" class="wysa-button-secondary text-sm">
            🔄 Get new quote
          </button>
        </div>

        <!-- IMAGINE Vertical Layout (spells I-M-A-G-I-N-E) -->
        <div class="space-y-3 mb-6">
          <div v-for="(section, index) in imagineSections" 
               :key="section.key"
               @click="goToSection(section.key)"
               class="imagine-horizontal-card bounce-in"
               :class="section.gradientClass"
               :style="{ animationDelay: (index * 0.1) + 's' }">
            <div class="flex items-center p-4">
              <div class="mr-4 pulsing">
                <div class="w-12 h-12 bg-gradient-to-br from-neon-cyan to-neon-blue rounded-full flex items-center justify-center text-xl">🐄</div>
              </div>
              <div class="flex-1">
                <h3 class="font-bold text-lg text-white text-shadow">{{ section.title }}</h3>
                <p class="text-sm text-white opacity-90">{{ section.subtitle }}</p>
              </div>
              <div class="text-white opacity-75">
                ▶
              </div>
            </div>
          </div>
        </div>

        <!-- Quick Actions -->
        <div class="grid grid-cols-2 gap-4">
          <button @click="quickMoodCheck" class="wysa-button text-center py-4">
            <div class="w-5 h-5 bg-gradient-to-br from-neon-green to-neon-cyan rounded-full mr-2 flex items-center justify-center text-xs">📊</div> Quick Mood Check
          </button>
          <button @click="chatWithMandy" class="wysa-button-secondary text-center py-4">
            <div class="w-5 h-5 bg-gradient-to-br from-neon-pink to-neon-purple rounded-full mr-2 flex items-center justify-center text-xs">💬</div> Chat with Mandy
          </button>
        </div>
      </main>

      <!-- IMAGINE Section Landing Page -->
      <main class="max-w-lg mx-auto p-4" v-if="currentView === 'section' && currentSection">
        <div class="flex items-center mb-6">
          <button @click="goToDashboard" class="mr-3 text-gray-600 text-2xl">←</button>
          <h2 class="text-xl font-semibold" style="color: var(--text-dark)">{{ currentSection.title }}</h2>
        </div>
        
        <!-- Section Description -->
        <div class="wysa-card mb-6" :class="currentSection.gradientClass">
          <div class="flex items-center mb-4">
            <div class="text-4xl mr-4">{{ currentSection.icon }}</div>
            <div>
              <h3 class="font-bold text-lg text-white text-shadow">{{ currentSection.title }}</h3>
              <p class="text-white opacity-90">{{ currentSection.subtitle }}</p>
            </div>
          </div>
        </div>

        <!-- AI Mandy Guidance -->
        <div class="wysa-card mb-6">
          <div class="flex items-center mb-3">
            <img class="hidden" alt="AI Mandy" class="cow-image mr-3" style="width: 60px; height: 60px;" />
            <div>
              <h3 class="font-semibold" style="color: var(--text-dark)">AI Mandy's Guidance</h3>
            </div>
          </div>
          <p style="color: var(--text-dark)">{{ getSectionGuidance(currentSection.key) }}</p>
        </div>

        <!-- Available Tools -->
        <div class="wysa-card">
          <h3 class="font-semibold mb-4" style="color: var(--text-dark)">Available Tools & Exercises</h3>
          <div class="space-y-3">
            <div v-for="tool in getSectionTools(currentSection.key)" 
                 :key="tool.id"
                 class="p-4 bg-gray-50 rounded-lg cursor-pointer hover:bg-gray-100 transition-colors">
              <div class="flex items-center">
                <div class="text-2xl mr-3">{{ tool.icon }}</div>
                <div>
                  <h4 class="font-semibold text-sm" style="color: var(--text-dark)">{{ tool.name }}</h4>
                  <p class="text-xs" style="color: var(--text-medium)">{{ tool.description }}</p>
                </div>
              </div>
            </div>
          </div>
        </div>
      </main>

      <!-- Enhanced Chat Interface with Therapeutic Features -->
      <main class="max-w-lg mx-auto" v-if="currentView === 'chat'">
        <!-- Chat Header with Therapeutic Context -->
        <div class="flex items-center p-4 bg-white border-b">
          <button @click="goToDashboard" class="mr-3 text-gray-600">←</button>
          <div class="w-10 h-10 bg-purple-200 rounded-full flex items-center justify-center mr-3">
            <img class="hidden" alt="Mandy" class="w-8 h-8 rounded-full">
          </div>
          <div class="flex-1">
            <h2 class="font-semibold">Mandy</h2>
            <p class="text-sm text-green-600">● Available for therapeutic coaching</p>
            <p class="text-xs text-gray-500" v-if="conversationContext.currentPattern">
              Current focus: {{ conversationContext.currentPattern }}
            </p>
          </div>
          <div class="text-xs text-gray-400">
            Phase: {{ conversationContext.sessionPhase }}
          </div>
        </div>
        
        <!-- Chat Messages with Enhanced Display -->
        <div class="h-96 overflow-y-auto p-4 bg-gray-50">
          <div v-for="message in chatHistory" :key="message.id" class="mb-4">
            <div :class="message.sender === 'user' ? 'flex justify-end' : 'flex justify-start'">
              <div class="max-w-xs">
                <!-- Message Content -->
                <div :class="message.sender === 'user' ? 
                             'bg-purple-500 text-white rounded-l-lg rounded-tr-lg p-3 shadow-sm' : 
                             'bg-white text-gray-800 rounded-r-lg rounded-tl-lg p-3 shadow-sm border border-gray-200'">
                  {{ message.text }}
                </div>
                
                <!-- Message Metadata (for Mandy's messages) -->
                <div v-if="message.sender === 'ai_mandy' && message.framework" 
                     class="text-xs text-gray-400 mt-1 px-2">
                  <span v-if="message.pattern">{{ message.pattern }} · </span>
                  {{ message.framework }}
                </div>
                
                <!-- Timestamp -->
                <div class="text-xs text-gray-400 mt-1 px-2">
                  {{ new Date(message.timestamp).toLocaleTimeString() }}
                </div>
              </div>
            </div>
          </div>
          
          <!-- Typing Indicator -->
          <div v-if="isTyping" class="flex justify-start mb-4">
            <div class="bg-white text-gray-800 rounded-r-lg rounded-tl-lg p-3 shadow-sm border border-gray-200 max-w-xs">
              <div class="flex space-x-1">
                <div class="w-2 h-2 bg-gray-400 rounded-full animate-bounce"></div>
                <div class="w-2 h-2 bg-gray-400 rounded-full animate-bounce" style="animation-delay: 0.1s"></div>
                <div class="w-2 h-2 bg-gray-400 rounded-full animate-bounce" style="animation-delay: 0.2s"></div>
              </div>
            </div>
          </div>
        </div>
        
        <!-- IMAGINE Quick Access -->
        <div class="p-2 bg-gray-100 border-t" v-if="conversationContext.userPreferredSection">
          <div class="text-xs text-gray-600 mb-2">Your preferred IMAGINE section:</div>
          <button @click="goToSection(conversationContext.userPreferredSection)" 
                  class="text-xs bg-purple-100 text-purple-600 px-2 py-1 rounded">
            {{ imagineSections.find(s => s.key === conversationContext.userPreferredSection)?.title }}
          </button>
        </div>
        
        <!-- Enhanced Input Area -->
        <div class="p-4 bg-white border-t">
          <!-- Coping Strategy Suggestions -->
          <div v-if="conversationContext.copingStrategiesOffered.length > 0" 
               class="mb-3 p-2 bg-blue-50 rounded text-sm">
            <div class="text-blue-700 font-medium mb-1">Recent coping strategies:</div>
            <div class="text-blue-600 text-xs">
              {{ conversationContext.copingStrategiesOffered[conversationContext.copingStrategiesOffered.length - 1] }}
            </div>
          </div>
          
          <!-- Message Input -->
          <div class="flex">
            <input v-model="newMessage" 
                   @keyup.enter="sendMessage"
                   placeholder="Share what's on your mind..."
                   class="flex-1 border rounded-l-lg px-3 py-2 focus:outline-none focus:ring-2 focus:ring-purple-500">
            <button @click="sendMessage" 
                    :disabled="!newMessage.trim()"
                    class="bg-purple-500 text-white px-4 py-2 rounded-r-lg hover:bg-purple-600 disabled:bg-gray-300 disabled:cursor-not-allowed">
              Send
            </button>
          </div>
          
          <!-- Session Info -->
          <div class="text-xs text-gray-500 mt-2 text-center">
            Safe space · Confidential · No judgment
          </div>
        </div>
      </main>

      <!-- Mood Check Interface -->
      <main class="max-w-lg mx-auto p-4" v-if="currentView === 'mood'">
        <div class="flex items-center mb-6">
          <button @click="goToDashboard" class="mr-3 text-gray-600">←</button>
          <h2 class="text-xl font-semibold">Mood Check-In</h2>
        </div>
        
        <div class="wysa-card">
          <h3 class="font-semibold mb-4" style="color: var(--text-dark)">How are you feeling right now?</h3>
          
          <div class="mb-6">
            <label class="block text-sm font-medium mb-3" style="color: var(--text-dark)">Mood Level (1-10)</label>
            <input type="range" v-model="moodEntry.level" min="1" max="10" class="mood-slider">
            <div class="flex justify-between text-sm mt-2" style="color: var(--text-medium)">
              <span>1 (Low)</span>
              <span class="font-semibold" style="color: var(--teal-character)">{{ moodEntry.level }}</span>
              <span>10 (High)</span>
            </div>
          </div>
          
          <div class="mb-6">
            <label class="block text-sm font-medium mb-2">What are you doing?</label>
            <input v-model="moodEntry.activity" 
                   placeholder="e.g., working, relaxing, exercising..."
                   class="w-full border rounded-lg px-3 py-2 focus:outline-none focus:ring-2 focus:ring-purple-500">
          </div>
          
          <div class="mb-6">
            <label class="block text-sm font-medium mb-2">Notes (optional)</label>
            <textarea v-model="moodEntry.notes" 
                      placeholder="Any thoughts or observations..."
                      class="w-full border rounded-lg px-3 py-2 h-20 focus:outline-none focus:ring-2 focus:ring-purple-500"></textarea>
          </div>
          
          <!-- Photo Upload Section -->
          <div class="mb-6">
            <label class="block text-sm font-medium mb-3" style="color: var(--text-dark)">
              📸 Add a Photo (optional)
            </label>
            <div class="photo-upload-area">
              <!-- File Input -->
              <input 
                type="file" 
                ref="photoInput"
                @change="handlePhotoSelection"
                accept="image/jpeg,image/jpg,image/png,image/gif,image/webp"
                class="hidden"
                id="moodPhotoInput"
              />
              
              <!-- Upload Button or Preview -->
              <div v-if="!moodEntry.photoPreview" 
                   @click="triggerPhotoUpload"
                   class="photo-upload-placeholder">
                <div class="upload-icon">📷</div>
                <p class="upload-text">Tap to add a photo</p>
                <p class="upload-hint">Share a moment from your day</p>
              </div>
              
              <!-- Photo Preview -->
              <div v-if="moodEntry.photoPreview" class="photo-preview-container">
                <img :src="moodEntry.photoPreview" 
                     alt="Mood photo preview" 
                     class="photo-preview" />
                <div class="photo-actions">
                  <button @click="triggerPhotoUpload" 
                          class="change-photo-btn">
                    🔄 Change Photo
                  </button>
                  <button @click="removePhoto" 
                          class="remove-photo-btn">
                    ❌ Remove
                  </button>
                </div>
              </div>
            </div>
          </div>
          
          <button @click="saveMoodEntry" 
                  class="w-full bg-purple-500 text-white py-3 rounded-lg hover:bg-purple-600 transition-colors">
            Save Mood Entry
          </button>
        </div>
      </main>

      <!-- Bottom Navigation -->
      <nav class="fixed bottom-0 left-0 right-0 bg-white border-t">
        <div class="max-w-lg mx-auto flex">
          <button @click="currentView = 'dashboard'" 
                  :class="currentView === 'dashboard' ? 'text-purple-600' : 'text-gray-400'"
                  class="flex-1 py-3 text-center">
            <div class="text-lg">🏠</div>
            <div class="text-xs">Home</div>
          </button>
          <button @click="currentView = 'progress'" 
                  :class="currentView === 'progress' ? 'text-purple-600' : 'text-gray-400'"
                  class="flex-1 py-3 text-center">
            <div class="text-lg">📊</div>
            <div class="text-xs">Progress</div>
          </button>
          <button @click="currentView = 'chat'" 
                  :class="currentView === 'chat' ? 'text-purple-600' : 'text-gray-400'"
                  class="flex-1 py-3 text-center">
            <div class="text-lg">💬</div>
            <div class="text-xs">Chat</div>
          </button>
          <button @click="currentView = 'settings'" 
                  :class="currentView === 'settings' ? 'text-purple-600' : 'text-gray-400'"
                  class="flex-1 py-3 text-center">
            <div class="text-lg">⚙️</div>
            <div class="text-xs">Settings</div>
          </button>
        </div>
      </nav>
    </div>
  </div>

  <script>
    
    const { createApp, ref, reactive, computed, onMounted } = Vue;

    createApp({
      setup() {
        // App state
        const currentView = ref('dashboard');
        const currentSection = ref(null);
        const user = reactive({
          username: 'User',
          preferences: {},
          moodHistory: [],
          imagineProgress: {
            // No streaks - just mindful presence tracking
            last_activity: null,
            favorite_sections: []
          }
        });

        // AI Mandy Coaching System
        const aiMandyGreeting = ref("Good morning! 🌅 I'm here to support you on your anxiety reduction journey. How are you feeling today?");
        
        const dailyQuote = ref({
          text: "The only way out is through. Take it one moment at a time.",
          author: "Mandy Kloppers"
        });

        // Mandy's CBT Coaching Methodology
        const mandyCoachingSystem = {
          // Universal Process: Listen → Gateway Question → Script Recognition → Redirect Energy → Sausage Machine
          universalProcess: {
            listen: (userMessage) => {
              // Active listening - acknowledge and reflect
              return {
                acknowledgment: "I hear you",
                reflection: userMessage.toLowerCase().includes('anxious') ? 
                  "That sounds like anxiety is showing up for you" :
                  userMessage.toLowerCase().includes('stuck') ?
                  "Feeling stuck can be really challenging" :
                  "Thank you for sharing that with me"
              };
            },
            gatewayQuestion: (context) => {
              // Core gateway questions that change everything
              const questions = [
                "What would you choose if this feeling wasn't here?",
                "What are you putting into your emotional sausage machine right now?",
                "Is this thought serving you, or is it just familiar?",
                "What would courage look like in this moment?",
                "If anxiety wasn't the boss, what would you do?"
              ];
              return questions[Math.floor(Math.random() * questions.length)];
            },
            scriptRecognition: (patterns) => {
              // Help identify automatic patterns vs conscious choices
              return {
                scriptIndicators: ["automatic", "always", "never", "should", "must", "have to"],
                reframe: "This sounds like a familiar pattern. When did you first learn to respond this way?"
              };
            },
            redirectEnergy: (fromPattern, toChoice) => {
              // Redirect from script patterns to conscious choices
              return "Let's redirect that energy toward what you actually want to create.";
            },
            sausageMachine: (input, desiredOutput) => {
              // You get out what you put in - change the input, change the output
              return "What you're putting in is creating what you're getting out. What would you rather put in?";
            }
          },

          // Mandy's Signature Language Patterns
          signaturePhrases: [
            "That sounds like a familiar pattern - how does this usually show up for you?",
            "What would you choose if anxiety wasn't making the decision?",
            "This feels like an old script. When did you first learn this response?",
            "Let's look at what you're feeding your mind. What's going into your sausage machine?",
            "I'm hearing the voice of should. What does your authentic voice say?",
            "This pattern is trying to keep you safe, but is it serving you now?",
            "What would self-compassion sound like here?",
            "Small steps count. What's one tiny thing you could do right now?",
            "You're already doing the work by noticing this pattern.",
            "What story would you rather be writing?"
          ],

          // CBT-Based Response Framework
          cbtFramework: {
            identifyPatterns: (userMessage) => {
              const anxietyPatterns = ['what if', 'worried about', 'scared that', 'anxious about'];
              const depressionPatterns = ['always', 'never', 'hopeless', 'pointless'];
              const perfectiomPatterns = ['should', 'must', 'have to', 'not good enough'];
              
              if (anxietyPatterns.some(pattern => userMessage.toLowerCase().includes(pattern))) {
                return 'anxiety';
              } else if (depressionPatterns.some(pattern => userMessage.toLowerCase().includes(pattern))) {
                return 'depression';
              } else if (perfectiomPatterns.some(pattern => userMessage.toLowerCase().includes(pattern))) {
                return 'perfectionism';
              }
              return 'general';
            },

            challengeThoughts: (pattern) => {
              const challenges = {
                anxiety: "Let's examine this worry. Is this thought based on facts or fears?",
                depression: "I notice some absolute thinking here. What evidence challenges this 'always' or 'never'?",
                perfectionism: "These sound like inherited rules. What would 'good enough' look like if you were choosing?",
                general: "What would you tell a good friend facing this same situation?"
              };
              return challenges[pattern] || challenges.general;
            },

            developCopingStrategies: (situation) => {
              return [
                "Let's practice the 3-breath reset: breathe in for 4, hold for 4, out for 6",
                "Try the 5-4-3-2-1 grounding: 5 things you see, 4 you hear, 3 you feel, 2 you smell, 1 you taste",
                "Use the 'noted' technique: when anxiety speaks, just say 'noted' and continue with your choice",
                "Practice the gateway question: 'What would I choose if this feeling wasn't here?'",
                "Remember your sausage machine: change what you're putting in to change what comes out"
              ];
            }
          },

          // IMAGINE Framework Integration
          imagineGuidance: {
            self_care: "Your relationship with yourself sets the tone for everything else. What would loving yourself look like today?",
            mindfulness: "This moment is the only one where change can happen. What do you notice right now?",
            acceptance: "Fighting what is only creates more suffering. What would accepting this situation allow?",
            gratitude: "Gratitude shifts perspective from lack to abundance. What's working in your life right now?",
            interactions: "Relationships are mirrors. What pattern is this showing you about yourself?",
            nurturing: "Joy is medicine for anxiety. What brings lightness to your heart?",
            exploring: "Curiosity dissolves fear. What if this challenge is here to teach you something?"
          },

          // Natural Conversation Guidelines
          conversationStyle: {
            tone: "warm, encouraging, professional but personal",
            approach: "therapeutic but conversational, not clinical",
            language: "use their words, avoid jargon unless explaining concepts",
            structure: "listen, reflect, explore, guide gently toward insight"
          },

          // Fallback Responses
          fallbacks: [
            "Tell me more about that.",
            "What's that like for you?",
            "How does this usually affect you?",
            "What would be helpful right now?",
            "That sounds really difficult."
          ]
        };

        // IMAGINE sections (spells I-M-A-G-I-N-E vertically)
        const imagineSections = ref([
          {
            key: 'self_care',
            title: 'I - Me, Myself & I',
            subtitle: 'Self-care and personal wellness',
            icon: '🐄',
            gradientClass: 'gradient-self-care'
          },
          {
            key: 'mindfulness',
            title: 'M - Mindfulness',
            subtitle: 'Present moment awareness',
            icon: '🐄',
            gradientClass: 'gradient-mindfulness'
          },
          {
            key: 'acceptance',
            title: 'A - Acceptance',
            subtitle: 'Embracing your current state',
            icon: '🐄',
            gradientClass: 'gradient-acceptance'
          },
          {
            key: 'gratitude',
            title: 'G - Gratitude',
            subtitle: 'Focusing on positive aspects',
            icon: '🐄',
            gradientClass: 'gradient-gratitude'
          },
          {
            key: 'interactions',
            title: 'I - Interactions',
            subtitle: 'Connecting with others',
            icon: '🐄',
            gradientClass: 'gradient-interactions'
          },
          {
            key: 'nurturing',
            title: 'N - Nurturing',
            subtitle: 'Fun, playfulness, and joy',
            icon: '🐄',
            gradientClass: 'gradient-nurturing'
          },
          {
            key: 'exploring',
            title: 'E - Exploring',
            subtitle: 'Understanding thoughts & behaviors',
            icon: '🐄',
            gradientClass: 'gradient-exploring'
          }
        ]);

        // Enhanced Chat System with Conversation History Management
        const chatHistory = ref([
          {
            id: 1,
            sender: 'ai_mandy',
            text: "Hello! I'm Mandy, your therapeutic coaching companion. I'm here to support you through whatever you're experiencing. What's on your mind today?",
            timestamp: new Date(),
            pattern: null,
            framework: 'greeting'
          }
        ]);
        const newMessage = ref('');
        const conversationContext = reactive({
          currentPattern: null,
          dominantTheme: null,
          sessionPhase: 'opening', // opening, exploring, deepening, integrating
          userPreferredSection: null,
          previousTopics: [],
          copingStrategiesOffered: [],
          lastMandyResponse: null
        });

        // Mood tracking
        const moodEntry = reactive({
          level: 5,
          activity: '',
          notes: '',
          photoData: null,
          photoPreview: null
        });

        // Methods
        const goToDashboard = () => currentView.value = 'dashboard';
        const goToSection = (sectionKey) => {
          const section = imagineSections.value.find(s => s.key === sectionKey);
          if (section) {
            currentSection.value = section;
            currentView.value = 'section';
          }
        };

        const getSectionGuidance = (sectionKey) => {
          // Use Mandy's IMAGINE framework guidance
          return mandyCoachingSystem.imagineGuidance[sectionKey] || "Welcome to this section of your journey. What would you like to explore today?";
        };

        const getSectionTools = (sectionKey) => {
          const tools = {
            self_care: [
              { id: 1, name: "Quick Wellness Check", description: "A gentle assessment of your current needs", icon: "🌟" },
              { id: 2, name: "Self-Care Planning", description: "Personalized suggestions for nurturing yourself", icon: "📝" },
              { id: 3, name: "Boundary Setting", description: "Practice saying no and protecting your energy", icon: "🛡️" },
              { id: 4, name: "Energy Management", description: "Track and optimize your daily energy", icon: "⚡" }
            ],
            mindfulness: [
              { id: 1, name: "Breathing Exercises", description: "Guided techniques to calm your nervous system", icon: "🫁" },
              { id: 2, name: "Present Moment Anchoring", description: "Quick grounding techniques for anxiety", icon: "⚓" },
              { id: 3, name: "Mindful Observation", description: "Photography and awareness exercises", icon: "📸" },
              { id: 4, name: "Body Scan", description: "Guided relaxation and awareness sessions", icon: "🧘" }
            ],
            acceptance: [
              { id: 1, name: "Emotion Acknowledgment", description: "Name and accept your feelings without judgment", icon: "❤️" },
              { id: 2, name: "Situation Acceptance", description: "Reframe challenges with compassion", icon: "🤲" },
              { id: 3, name: "Self-Compassion", description: "Gentle self-talk and kindness prompts", icon: "💝" },
              { id: 4, name: "Letting Go", description: "Release techniques and visualizations", icon: "🕊️" }
            ],
            gratitude: [
              { id: 1, name: "Gratitude Journaling", description: "Daily appreciation prompts and reflection", icon: "📔" },
              { id: 2, name: "Photo Gratitude", description: "Capture moments of beauty and appreciation", icon: "📷" },
              { id: 3, name: "Gratitude Sharing", description: "Connect with others through appreciation", icon: "💌" },
              { id: 4, name: "Perspective Shifting", description: "Find positives in challenges", icon: "🔄" }
            ],
            interactions: [
              { id: 1, name: "Social Energy Check", description: "Assess your social needs and capacity", icon: "🎭" },
              { id: 2, name: "Connection Planning", description: "Schedule meaningful interactions", icon: "📅" },
              { id: 3, name: "Boundary Communication", description: "Scripts for difficult conversations", icon: "💬" },
              { id: 4, name: "Empathy Exercises", description: "Understand others' perspectives", icon: "🤝" }
            ],
            nurturing: [
              { id: 1, name: "Playfulness Prompts", description: "Silly, fun activity suggestions", icon: "🎪" },
              { id: 2, name: "Humor Therapy", description: "Jokes, laughter, and lightness", icon: "😄" },
              { id: 3, name: "Creative Expression", description: "Art, music, and writing prompts", icon: "🎨" },
              { id: 4, name: "Joy Cultivation", description: "Identify and pursue happiness", icon: "✨" }
            ],
            exploring: [
              { id: 1, name: "Thought Pattern Recognition", description: "CBT-based thought tracking", icon: "🧠" },
              { id: 2, name: "Behavior Analysis", description: "Understand your responses and patterns", icon: "🔍" },
              { id: 3, name: "Confidence Building", description: "Challenge avoidance patterns", icon: "💪" },
              { id: 4, name: "Anxiety Cycle Breaking", description: "Interrupt negative spirals", icon: "🔄" }
            ]
          };
          return tools[sectionKey] || [];
        };

        const getNewQuote = () => {
          const quotes = [
            { text: "Anxiety is not your enemy. It's information about what matters to you.", author: "Mandy Kloppers" },
            { text: "Small steps in the right direction can turn out to be the biggest steps of your life.", author: "Mandy Kloppers" },
            { text: "You are stronger than you think and more resilient than you know.", author: "Mandy Kloppers" },
            { text: "Progress, not perfection, is the goal.", author: "Mandy Kloppers" }
          ];
          const randomQuote = quotes[Math.floor(Math.random() * quotes.length)];
          dailyQuote.value = randomQuote;
        };

        const quickMoodCheck = () => {
          currentView.value = 'mood';
        };

        const chatWithMandy = () => {
          currentView.value = 'chat';
        };

        // Advanced AI Mandy Coaching Response System
        const generateMandyResponse = (userMessage) => {
          // Step 1: Listen - Use Universal Process
          const listening = mandyCoachingSystem.universalProcess.listen(userMessage);
          
          // Step 2: Identify patterns using CBT framework
          const identifiedPattern = mandyCoachingSystem.cbtFramework.identifyPatterns(userMessage);
          
          // Step 3: Update conversation context
          conversationContext.currentPattern = identifiedPattern;
          if (!conversationContext.previousTopics.includes(identifiedPattern)) {
            conversationContext.previousTopics.push(identifiedPattern);
          }
          
          // Step 4: Determine appropriate response based on Universal Process
          let response = "";
          
          // Check if this is a continuation of a theme
          const isNewPattern = conversationContext.lastMandyResponse?.pattern !== identifiedPattern;
          
          if (conversationContext.sessionPhase === 'opening' || isNewPattern) {
            // Use signature phrase for pattern recognition
            const signaturePhrase = mandyCoachingSystem.signaturePhrases[
              Math.floor(Math.random() * mandyCoachingSystem.signaturePhrases.length)
            ];
            response = listening.reflection + ". " + signaturePhrase;
            conversationContext.sessionPhase = 'exploring';
            
          } else if (conversationContext.sessionPhase === 'exploring') {
            // Use gateway question
            const gatewayQuestion = mandyCoachingSystem.universalProcess.gatewayQuestion(conversationContext);
            response = gatewayQuestion;
            conversationContext.sessionPhase = 'deepening';
            
          } else if (conversationContext.sessionPhase === 'deepening') {
            // Offer CBT thought challenging
            const challenge = mandyCoachingSystem.cbtFramework.challengeThoughts(identifiedPattern);
            response = challenge;
            conversationContext.sessionPhase = 'integrating';
            
          } else {
            // Integration phase - offer coping strategies
            const strategies = mandyCoachingSystem.cbtFramework.developCopingStrategies();
            const randomStrategy = strategies[Math.floor(Math.random() * strategies.length)];
            response = "Let's try something practical. " + randomStrategy;
            conversationContext.copingStrategiesOffered.push(randomStrategy);
            conversationContext.sessionPhase = 'exploring'; // Cycle back for continued support
          }
          
          // Context-aware additions
          if (userMessage.toLowerCase().includes('imagine') || userMessage.toLowerCase().includes('section')) {
            // User is referencing IMAGINE framework
            const sections = ['self_care', 'mindfulness', 'acceptance', 'gratitude', 'interactions', 'nurturing', 'exploring'];
            const mentionedSection = sections.find(section => 
              userMessage.toLowerCase().includes(section) || 
              userMessage.toLowerCase().includes(section.replace('_', ' '))
            );
            
            if (mentionedSection) {
              response += " " + mandyCoachingSystem.imagineGuidance[mentionedSection];
              conversationContext.userPreferredSection = mentionedSection;
            }
          }
          
          // Add encouraging close for longer responses
          if (response.length > 100) {
            response += " You're doing important work by exploring this.";
          }
          
          return {
            text: response,
            pattern: identifiedPattern,
            framework: conversationContext.sessionPhase,
            timestamp: new Date()
          };
        };

        // Typing indicator state
        const isTyping = ref(false);

        const sendMessage = () => {
          if (!newMessage.value.trim()) return;
          
          const userMessageText = newMessage.value;
          
          // Add user message to history
          chatHistory.value.push({
            id: Date.now(),
            sender: 'user',
            text: userMessageText,
            timestamp: new Date()
          });

          // Clear input and show typing indicator
          newMessage.value = '';
          isTyping.value = true;

          // Generate sophisticated Mandy response
          setTimeout(() => {
            const mandyResponse = generateMandyResponse(userMessageText);
            
            const aiMessage = {
              id: Date.now() + 1,
              sender: 'ai_mandy',
              text: mandyResponse.text,
              timestamp: mandyResponse.timestamp,
              pattern: mandyResponse.pattern,
              framework: mandyResponse.framework
            };
            
            chatHistory.value.push(aiMessage);
            conversationContext.lastMandyResponse = aiMessage;
            isTyping.value = false;
            
            // Scroll to bottom of chat
            setTimeout(() => {
              const chatContainer = document.querySelector('.h-96');
              if (chatContainer) {
                chatContainer.scrollTop = chatContainer.scrollHeight;
              }
            }, 100);
            
          }, 1200); // Slightly longer delay for more natural feel
        };

        // Photo handling functions
        const triggerPhotoUpload = () => {
          const input = document.getElementById('moodPhotoInput');
          if (input) {
            input.click();
          }
        };

        const handlePhotoSelection = (event) => {
          const file = event.target.files[0];
          if (!file) return;

          // Validate file type
          const validTypes = ['image/jpeg', 'image/jpg', 'image/png', 'image/gif', 'image/webp'];
          if (!validTypes.includes(file.type)) {
            alert('Please select a valid image file (JPG, PNG, GIF, or WebP)');
            return;
          }

          // Validate file size (max 5MB)
          if (file.size > 5 * 1024 * 1024) {
            alert('Photo size should be less than 5MB');
            return;
          }

          const reader = new FileReader();
          reader.onload = (e) => {
            moodEntry.photoData = e.target.result;
            moodEntry.photoPreview = e.target.result;
          };
          reader.readAsDataURL(file);
        };

        const removePhoto = () => {
          moodEntry.photoData = null;
          moodEntry.photoPreview = null;
          // Clear the file input
          const input = document.getElementById('moodPhotoInput');
          if (input) {
            input.value = '';
          }
        };

        const saveMoodEntry = () => {
          user.moodHistory.push({
            ...moodEntry,
            timestamp: new Date(),
            id: Date.now()
          });
          
          // Reset form
          moodEntry.level = 5;
          moodEntry.activity = '';
          moodEntry.notes = '';
          moodEntry.photoData = null;
          moodEntry.photoPreview = null;
          
          // Clear the file input
          const input = document.getElementById('moodPhotoInput');
          if (input) {
            input.value = '';
          }
          
          // Show success and return to dashboard
          alert('Mood entry saved! 🌟');
          currentView.value = 'dashboard';
        };

        // Initialize
        onMounted(() => {
          console.log('Theracowch app initialized');
          
          // Update greeting based on time
          const hour = new Date().getHours();
          if (hour < 12) {
            aiMandyGreeting.value = "Good morning! 🌅 Ready to start your day with some self-care?";
          } else if (hour < 17) {
            aiMandyGreeting.value = "Good afternoon! ☀️ How has your day been treating you?";
          } else {
            aiMandyGreeting.value = "Good evening! 🌙 Time to reflect and unwind. How are you feeling?";
          }
        });

        return {
          currentView,
          currentSection,
          user,
          aiMandyGreeting,
          dailyQuote,
          imagineSections,
          chatHistory,
          newMessage,
          moodEntry,
          mandyCoachingSystem,
          conversationContext,
          isTyping,
          goToDashboard,
          goToSection,
          getSectionGuidance,
          getSectionTools,
          getNewQuote,
          quickMoodCheck,
          chatWithMandy,
          sendMessage,
          generateMandyResponse,
          saveMoodEntry,
          triggerPhotoUpload,
          handlePhotoSelection,
          removePhoto
        };
      }
    }).mount('#app');
  </script>
</body>
</html>